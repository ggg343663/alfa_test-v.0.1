<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Request Master | DTC Magic Chain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      color: #222;
      margin: 0; padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 440px;
      margin: 2.5em auto;
      background: #fff;
      padding: 2em 1.6em 2.2em 1.6em;
      border-radius: 18px;
      box-shadow: 0 6px 32px #1771b415, 0 1.5px 5px #7ed9a340;
    }
    h2 {
      text-align: center;
      color: #246bfd;
      margin-bottom: 1.3em;
      letter-spacing:0.01em;
    }
    .step {
      text-align: center;
      color: #219150;
      font-size: 1.05em;
      margin-bottom: 1.2em;
    }
    label { display:block; margin: 1.2em 0 0.2em 0; font-weight:600; }
    input[type="text"] {
      width: 100%;
      padding: 0.66em 0.6em;
      border: 1.5px solid #dbdbdb;
      border-radius: 7px;
      font-size: 1.05em;
      background: #fcfcfc;
      margin-bottom: 0.3em;
      transition: border 0.2s;
    }
    input[type="text"]:focus {
      border: 1.5px solid #246bfd;
      outline: none;
      background: #f0f8ff;
    }
    .input-error { border:1.5px solid #ff4a4a!important; background:#fff2f2!important;}
    .msg-warn, .msg-error {
      color: #b91c1c; background: #fff4f2;
      border-left: 5px solid #e85028; padding: 0.66em 1em;
      border-radius: 9px; margin-bottom: 0.3em; font-size: 0.97em;
    }
    .form-warn {color:#b91c1c;background:#fff9e4;border-left:4px solid #ffc04d;padding:0.6em 1em;border-radius:8px;margin-bottom:1em;}
    .success-msg {
      color: #26733e; background: #eafaf0;
      border-left: 5px solid #219150; padding: 0.7em 1em; border-radius: 8px; margin-bottom: 1.1em; font-size: 1em;
    }
    .btn {
      display: block; width: 100%; margin: 1.3em 0 1.1em 0;
      padding: 0.85em 0; border: none; border-radius: 12px;
      font-size: 1.12em; font-weight: 600; letter-spacing: 0.02em;
      background: linear-gradient(90deg,#219150 75%,#246bfd 100%);
      color: #fff; cursor: pointer;
      transition: background 0.19s, box-shadow 0.22s;
      box-shadow: 0 2px 12px #21915018;
    }
    .btn:active { background: #176d38; }
    .copy-btn, .paste-btn {
      margin-left:0.15em;
      background: #e6f0fe;
      border: 1px solid #bcd6fa;
      color: #246bfd;
      padding: 0.15em 0.78em;
      border-radius: 5px;
      font-size: 0.97em;
      cursor:pointer;
      vertical-align: middle;
      transition: background 0.13s;
    }
    .paste-btn:hover, .copy-btn:hover { background: #ffe066; color: #5c4700;}
    .pubkey-count { font-size: 0.92em; color: #c77700; margin-left: 0.5em;}
    .copy-success { color: #26733e; font-size: 0.98em; margin-left: 0.35em; opacity: 0; transition: opacity 0.6s;}
    .copy-success.show { opacity: 1; }
    .back-btn {
      background: #f3f3f3; color: #26733e; border: none;
      padding: 0.45em 1.3em; font-size: 1em;
      border-radius: 5px; cursor: pointer; margin-bottom: 1.5em;
      margin-left: -0.8em;
    }
    .back-btn:hover { background: #e0e7ef;}
    .note { text-align:center;color:#789;font-size:0.97em;margin-top:1.4em;}
    @media (max-width: 600px) {
      .container { padding: 1em 0.2em 1.5em 0.2em; border-radius: 0; }
      .btn, .back-btn { width: 100%; margin-left:0;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="step">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3/4</div>
    <button class="back-btn" onclick="history.back()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
    <h2>‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Master</h2>

    <div id="badwordWarn" class="form-warn" style="display:none;"></div>
    <form id="requestMasterForm" autocomplete="off">
      <label>‡∏ä‡∏∑‡πà‡∏≠ Master (A-Z ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô): 
        <input type="text" id="masterName" maxlength="8" pattern="[A-Z]+" required autocomplete="off">
      </label>
      <label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠ Master: 
        <input type="text" id="confirmName" maxlength="8" pattern="[A-Z]+" required autocomplete="off">
      </label>
      <div id="nameMatchWarn" class="msg-warn" style="display:none;"></div>
      <label>
        Public Key (64 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ HEX): 
        <input type="text" id="pubkey" pattern="^[a-f0-9]{64}$" maxlength="64" required autocomplete="off" />
        <button type="button" class="paste-btn" onclick="pastePubkey('pubkey')">Paste</button>
        <button type="button" class="copy-btn" onclick="copyField('pubkey')" title="Copy">Copy</button>
        <span class="pubkey-count" id="pubkeyCount">0/64</span>
        <span class="copy-success" id="copySuccess"></span>
      </label>
      <label>
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Public Key:
        <input type="text" id="confirmPubkey" pattern="^[a-f0-9]{64}$" maxlength="64" required autocomplete="off" />
        <button type="button" class="paste-btn" onclick="pastePubkey('confirmPubkey')">Paste</button>
        <button type="button" class="copy-btn" onclick="copyField('confirmPubkey')" title="Copy">Copy</button>
        <span class="pubkey-count" id="confirmPubkeyCount">0/64</span>
      </label>
      <small>üìå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á Public Key ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</small>
      <button type="submit" class="btn">Request Master</button>
    </form>

    <div id="resultBox" style="display:none;">
      <div class="success-msg">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>Hash ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏≠ Master:</div>
      <div style="background:#e8f3fe;padding:1em;border-radius:8px;margin-bottom:1em;">
        <b>Request Hash:</b> <span id="hashOutput" style="word-break:break-all;"></span><br>
        <b>Timestamp:</b> <span id="timestamp"></span><br>
        <b>Nonce:</b> <span id="nonce"></span>
      </div>
      <button class="copy-btn" onclick="copyHash()">Copy Hash</button>
      <span class="copy-success" id="copyHashSuccess"></span>
    </div>
    <a href="index.html" class="btn" style="background:#e0e7ef;color:#26733e;margin-top:0.25em;font-weight:500;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    <p class="note">
      (‡∏ä‡∏∑‡πà‡∏≠ Master ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà GENESIS ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏ß‡∏ô)<br>
      Public Key ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡∏ß 64 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (HEX ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö generate key)<br>
      <b>‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡πÄ‡∏≠‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î ‡πÜ</b>
    </p>
  </div>
<script>
  // Badword Loader
  let badwordList = {};
  let hasBadword = false;
  let badwordLoaded = false;
  fetch('badwords.json')
    .then(res => res.json())
    .then(data => {badwordList = data; badwordLoaded = true;})
    .catch(() => {badwordLoaded=false;});
  function showBadwordWarn(msg) {
    const warn = document.getElementById('badwordWarn');
    warn.style.display = 'block';
    warn.innerHTML = msg;
  }
  function hideBadwordWarn() {
    document.getElementById('badwordWarn').style.display = 'none';
  }
  function checkBadwords(inputValue) {
    const input = inputValue.toLowerCase();
    let found = [];
    for (const group of Object.values(badwordList)) {
      group.forEach(word => {
        const re = new RegExp("\\b"+word+"\\b", "i");
        if (re.test(input)) found.push(word);
      });
    }
    if (found.length > 0) {
      showBadwordWarn(`‚ö† <span style="color:red; font-weight:bold;">Badword:</span> ${found.join(', ')}<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏≥‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á`);
      hasBadword = true;
    } else {
      hideBadwordWarn();
      hasBadword = false;
    }
  }
  // ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï GENESIS ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏ß‡∏ô
  function isReservedName(name) {
    return ["GENESIS", "ADMIN", "ROOT"].includes(name.toUpperCase());
  }
  function toUpperAZ(str) { return str.toUpperCase().replace(/[^A-Z]/g, ''); }
  document.getElementById('masterName').addEventListener('input', function () {
    this.value = toUpperAZ(this.value);
    if(badwordLoaded) checkBadwords(this.value);
    checkNameMatch();
  });
  document.getElementById('confirmName').addEventListener('input', function () {
    this.value = toUpperAZ(this.value);
    checkNameMatch();
  });
  function checkNameMatch() {
    const name = document.getElementById('masterName').value.trim();
    const confirm = document.getElementById('confirmName').value.trim();
    const warn = document.getElementById('nameMatchWarn');
    if (name && confirm && name !== confirm) {
      warn.innerText = '‚ö† ‡∏ä‡∏∑‡πà‡∏≠ Master ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô!';
      warn.style.display = 'block';
      document.getElementById('confirmName').classList.add('input-error');
    } else if (isReservedName(name)) {
      warn.innerText = '‚ö† ‡∏ä‡∏∑‡πà‡∏≠ Master ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏á‡∏ß‡∏ô‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ';
      warn.style.display = 'block';
      document.getElementById('masterName').classList.add('input-error');
    } else {
      warn.innerText = '';
      warn.style.display = 'none';
      document.getElementById('confirmName').classList.remove('input-error');
      document.getElementById('masterName').classList.remove('input-error');
    }
  }
  // Autofill public key
  window.onload = function(){
    document.getElementById('masterName').focus();
    let pubKey = localStorage.getItem('dtc_publicKey');
    if (pubKey && /^[a-f0-9]{64}$/i.test(pubKey)) {
      document.getElementById('pubkey').value = pubKey;
      document.getElementById('confirmPubkey').value = pubKey;
      document.getElementById('pubkeyCount').innerText = pubKey.length + "/64";
      document.getElementById('confirmPubkeyCount').innerText = pubKey.length + "/64";
    }
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ public key redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ generate key
    if (!pubKey) {
      setTimeout(()=>{window.location.href = "generate_key.html";}, 1100);
    }
  };
  document.getElementById('pubkey').addEventListener('input', function () {
    this.value = this.value.replace(/[^a-f0-9]/gi,'');
    document.getElementById('pubkeyCount').innerText = this.value.length + "/64";
  });
  document.getElementById('confirmPubkey').addEventListener('input', function () {
    this.value = this.value.replace(/[^a-f0-9]/gi,'');
    document.getElementById('confirmPubkeyCount').innerText = this.value.length + "/64";
  });
  // Copy/Paste
  function copyField(id) {
    const el = document.getElementById(id);
    el.select(); el.setSelectionRange(0, 9999);
    navigator.clipboard.writeText(el.value);
    showCopySuccess();
  }
  function showCopySuccess() {
    const el = document.getElementById('copySuccess');
    el.innerText = "Copied!";
    el.classList.add('show');
    setTimeout(()=>el.classList.remove('show'),1100);
  }
  async function pastePubkey(id) {
    try {
      const text = await navigator.clipboard.readText();
      if (/^[a-f0-9]{64}$/i.test(text)) {
        document.getElementById(id).value = text.substring(0,64);
        document.getElementById(id+'Count').innerText = document.getElementById(id).value.length + "/64";
      }
    } catch {}
  }
  // Form submit
  document.getElementById('requestMasterForm').onsubmit = function (e) {
    e.preventDefault();
    const name = document.getElementById('masterName').value.trim();
    const confirm = document.getElementById('confirmName').value.trim();
    const pubkey = document.getElementById('pubkey').value.trim();
    const confirmPubkey = document.getElementById('confirmPubkey').value.trim();
    if (isReservedName(name)) {
      showResult("‚ùå ‡∏ä‡∏∑‡πà‡∏≠ Master ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏á‡∏ß‡∏ô‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ");
      document.getElementById('masterName').focus();
      return;
    }
    if (name !== confirm) {
      showResult("‚ùå ‡∏ä‡∏∑‡πà‡∏≠ Master ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
      document.getElementById('confirmName').focus();
      return;
    }
    if (pubkey !== confirmPubkey) {
      showResult("‚ùå Public Key ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Public Key ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
      document.getElementById('confirmPubkey').focus();
      return;
    }
    if (!/^[a-f0-9]{64}$/i.test(pubkey)) {
      showResult("‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Public Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á 64 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ HEX)");
      document.getElementById('pubkey').focus();
      return;
    }
    if (hasBadword) {
      if (!confirm('‚ö†Ô∏è ‡∏ä‡∏∑‡πà‡∏≠ Master ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°\n\n‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        document.getElementById('masterName').focus();
        return;
      }
    }
    if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\n\n(Confirm to proceed: All information will be public.)")) {
      return;
    }
    const timestamp = new Date().toISOString();
    const nonce = Array.from(crypto.getRandomValues(new Uint8Array(8))).map(b => b.toString(16).padStart(2, "0")).join('');
    const s = name + pubkey + timestamp + nonce;
    const hash = sha256(s);
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    document.getElementById('resultBox').style.display = "block";
    document.getElementById('hashOutput').innerText = hash;
    document.getElementById('timestamp').innerText = timestamp;
    document.getElementById('nonce').innerText = nonce;
    setTimeout(()=>{document.getElementById('resultBox').scrollIntoView({behavior:'smooth'});},120);
  };
  function showResult(msg) {
    alert(msg);
  }
  function copyHash() {
    const hash = document.getElementById('hashOutput').innerText;
    navigator.clipboard.writeText(hash);
    const el = document.getElementById('copyHashSuccess');
    el.innerText = "Copied!";
    el.classList.add('show');
    setTimeout(()=>el.classList.remove('show'),1200);
  }
</script>
</body>
</html>
