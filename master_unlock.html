<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Master Unlock QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; padding: 2em; }
    .container {
      background: #fff;
      padding: 2em 1.3em;
      max-width: 410px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 2px 14px rgba(0,0,0,0.06);
    }
    h2 { text-align: center; margin-bottom: 1.5em; color: #3734a9;}
    label { display: block; margin-top: 1em; font-weight: 600;}
    input { width: 100%; margin-top: 0.38em; padding: 0.54em 0.7em; font-size: 1em; border-radius: 7px; border: 1px solid #cfd9ec;}
    button {
      width: 100%; margin-top: 1.4em; padding: 0.7em 0; font-size: 1.04em;
      background: linear-gradient(90deg, #6366f1, #22d3ee);
      color: #fff; border: none; border-radius: 8px; font-weight: bold;
      letter-spacing: 0.01em; cursor: pointer; transition: background 0.18s;
    }
    button:hover { background: linear-gradient(90deg, #22d3ee, #6366f1);}
    .btn-back { background: #dbeafe; color: #324275; margin-top: 1.2em;}
    .btn-back:hover { background: #bae6fd;}
    #status { margin-top: 1.5em; font-size: 1em; text-align: center; white-space: pre-wrap;}
    .error { color: #d93025;}
    .success { color: #1a7300;}
  </style>
</head>
<body>
  <div class="container">
    <h2>Master Unlock QR</h2>
    <form id="masterUnlockForm" autocomplete="off">
      <label for="pw1">Password (6-12 letters & numbers):</label>
      <input type="password" id="pw1" maxlength="12" minlength="6" placeholder="Password" required autocomplete="off" />

      <label for="pw2">Confirm Password:</label>
      <input type="password" id="pw2" maxlength="12" minlength="6" placeholder="Confirm Password" required autocomplete="off" />

      <label for="sign1">4-digit Sign Code:</label>
      <input type="password" id="sign1" maxlength="4" minlength="4" pattern="\d{4}" placeholder="Sign Code" required autocomplete="off" />

      <label for="sign2">Confirm 4-digit Sign Code:</label>
      <input type="password" id="sign2" maxlength="4" minlength="4" pattern="\d{4}" placeholder="Confirm Sign Code" required autocomplete="off" />

      <label for="amount">Number of QR to unlock:</label>
      <input type="number" id="amount" min="1" value="1" required />

      <button type="submit">Unlock QR</button>
    </form>
    <div id="status"></div>
    <button class="btn-back" onclick="window.history.back()">← Back</button>
  </div>

  <script>
    function validatePassword(pw) {
      return (
        pw.length >= 6 &&
        pw.length <= 12 &&
        /[A-Za-z]/.test(pw) &&
        /\d/.test(pw)
      );
    }

    document.getElementById('masterUnlockForm').onsubmit = function(e) {
      e.preventDefault();
      const pw1 = this.pw1.value.trim();
      const pw2 = this.pw2.value.trim();
      const sign1 = this.sign1.value.trim();
      const sign2 = this.sign2.value.trim();
      const amount = parseInt(this.amount.value, 10);
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = "";
      statusDiv.className = "";

      if (!validatePassword(pw1)) {
        statusDiv.textContent = "Password must be 6-12 characters with both letters and numbers.";
        statusDiv.className = "error";
        return;
      }
      if (pw1 !== pw2) {
        statusDiv.textContent = "Passwords do not match.";
        statusDiv.className = "error";
        return;
      }
      if (!/^\d{4}$/.test(sign1)) {
        statusDiv.textContent = "Sign code must be 4 digits.";
        statusDiv.className = "error";
        return;
      }
      if (sign1 !== sign2) {
        statusDiv.textContent = "Sign codes do not match.";
        statusDiv.className = "error";
        return;
      }
      if (isNaN(amount) || amount < 1) {
        statusDiv.textContent = "Number of QR must be a positive integer.";
        statusDiv.className = "error";
        return;
      }

      // Use: SHA256(password + sign + number_of_QR)
      const sig = sha256(pw1 + sign1 + amount);

      statusDiv.innerHTML =
        `<span class="success">✅ Unlocked ${amount} QR codes successfully!</span>\nSignature (SHA256): <code>${sig}</code>`;
      statusDiv.className = "success";
      // TODO: submit to backend or further process
    };
  </script>
</body>
</html>
