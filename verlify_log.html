<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>ตรวจสอบประวัติการลงทะเบียน QR (Log Viewer)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 2em auto;
    padding: 1em;
    background: #f9f9f9;
    border-radius: 8px;
  }
  h1 {
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1em;
  }
  th, td {
    padding: 0.5em;
    border: 1px solid #ccc;
    text-align: left;
    font-size: 0.9em;
  }
  th {
    background-color: #4CAF50;
    color: white;
  }
  input[type="text"] {
    padding: 0.5em;
    width: 250px;
    font-size: 1em;
    margin-top: 1em;
  }
  #searchRow {
    margin-bottom: 1em;
  }
  .no-data {
    text-align: center;
    padding: 1em;
    color: #999;
  }
</style>
</head>
<body>
  <h1>ตรวจสอบประวัติการลงทะเบียน QR</h1>

  <div id="searchRow">
    <label for="searchInput">ค้นหา (QR hash, Public Key): </label>
    <input type="text" id="searchInput" placeholder="พิมพ์คำค้นหา..." />
  </div>

  <table id="logTable">
    <thead>
      <tr>
        <th>วันที่-เวลา</th>
        <th>QR Hash</th>
        <th>Public Key</th>
        <th>กิจกรรม</th>
        <th>รายละเอียด</th>
      </tr>
    </thead>
    <tbody id="logBody">
      <!-- รายการ log จะถูกเพิ่มที่นี่ -->
    </tbody>
  </table>

  <script>
    // สมมติข้อมูล Log แบบ JSON (ในระบบจริงจะดึงจาก backend หรือไฟล์)
    const logs = [
      {
        datetime: "2025-06-01T10:15:00Z",
        qrHash: "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
        pubKey: "1234567890abcdef1234567890abcdef12345678",
        action: "ลงทะเบียน",
        detail: "ลงทะเบียน QR ครั้งแรก"
      },
      {
        datetime: "2025-06-02T12:30:00Z",
        qrHash: "fedcba0987654321fedcba0987654321fedcba0987654321fedcba0987654321",
        pubKey: "abcdef1234567890abcdef1234567890abcdef12",
        action: "โอนกรรมสิทธิ์",
        detail: "โอนกรรมสิทธิ์ QR ไปยัง Public Key ใหม่"
      },
      {
        datetime: "2025-06-03T09:45:00Z",
        qrHash: "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
        pubKey: "1234567890abcdef1234567890abcdef12345678",
        action: "ปลดล็อก Master",
        detail: "Master ปลดล็อก QR"
      }
      // เพิ่มรายการ log ตามจริงได้เรื่อย ๆ
    ];

    const logBody = document.getElementById('logBody');
    const searchInput = document.getElementById('searchInput');

    // ฟังก์ชันแสดง log ในตาราง
    function renderLogs(filterText = "") {
      const filter = filterText.toLowerCase();
      logBody.innerHTML = "";

      const filteredLogs = logs.filter(log => 
        log.qrHash.toLowerCase().includes(filter) || 
        log.pubKey.toLowerCase().includes(filter) || 
        log.action.toLowerCase().includes(filter) ||
        log.detail.toLowerCase().includes(filter)
      );

      if (filteredLogs.length === 0) {
        logBody.innerHTML = `<tr><td colspan="5" class="no-data">ไม่พบข้อมูลที่ตรงกับคำค้นหา</td></tr>`;
        return;
      }

      filteredLogs.forEach(log => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${new Date(log.datetime).toLocaleString()}</td>
          <td><code>${log.qrHash}</code></td>
          <td><code>${log.pubKey}</code></td>
          <td>${log.action}</td>
          <td>${log.detail}</td>
        `;
        logBody.appendChild(tr);
      });
    }

    // เรียกแสดง log ครั้งแรก
    renderLogs();

    // กรอง log ขณะพิมพ์ค้นหา
    searchInput.addEventListener('input', e => {
      renderLogs(e.target.value);
    });
  </script>
</body>
</html>
