<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>ตรวจสอบประวัติการลงทะเบียน QR (Log Viewer)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 2em auto;
    padding: 1em;
    background: #f9f9f9;
    border-radius: 8px;
  }
  h1, h2 {
    text-align: center;
  }
  label {
    font-weight: bold;
  }
  #searchRow {
    margin-bottom: 1em;
    text-align: center;
  }
  #qrSearchInput {
    padding: 0.5em;
    width: 300px;
    font-size: 1em;
  }
  #clearBtn {
    margin-left: 10px;
    padding: 0.5em 1em;
    font-size: 1em;
    cursor: pointer;
    border-radius: 5px;
    border: none;
    background-color: #f44336;
    color: white;
    transition: background-color 0.3s ease;
  }
  #clearBtn:hover {
    background-color: #d32f2f;
  }
  #ownerStatus {
    margin-top: 1em;
    font-weight: bold;
    text-align: center;
  }
  #logList {
    margin-top: 1em;
    border-collapse: collapse;
    width: 100%;
  }
  #logList th, #logList td {
    border: 1px solid #ccc;
    padding: 0.5em;
    font-size: 0.9em;
    text-align: left;
  }
  #logList th {
    background-color: #4CAF50;
    color: white;
  }
  #logList tbody tr:nth-child(even) {
    background-color: #f2f2f2;
  }
  .no-data {
    text-align: center;
    padding: 1em;
    color: #999;
  }
</style>
</head>
<body>
  <h1>ตรวจสอบประวัติการลงทะเบียน QR (Log Viewer)</h1>

  <div id="searchRow">
    <label for="qrSearchInput">ค้นหา QR Hash:</label>
    <input type="text" id="qrSearchInput" placeholder="พิมพ์ QR hash 64 ตัวอักษร เพื่อดูสายโซ่" maxlength="64" />
    <button id="clearBtn" type="button">ล้างข้อมูล</button>
  </div>

  <div id="ownerStatus"></div>

  <table id="logList" style="display:none;">
    <thead>
      <tr>
        <th>วันที่-เวลา</th>
        <th>กิจกรรม</th>
        <th>รายละเอียด</th>
        <th>Public Key (เจ้าของ)</th>
      </tr>
    </thead>
    <tbody id="logListBody">
    </tbody>
  </table>

  <div id="noDataMsg" class="no-data" style="display:block;">กรุณาค้นหา QR hash เพื่อดูประวัติ</div>

  <script>
    const logs = [
      {
        datetime: "2025-06-01T10:15:00Z",
        qrHash: "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
        pubKey: "1234567890abcdef1234567890abcdef12345678",
        action: "ลงทะเบียน",
        detail: "ลงทะเบียน QR ครั้งแรก"
      },
      {
        datetime: "2025-06-02T12:30:00Z",
        qrHash: "fedcba0987654321fedcba0987654321fedcba0987654321fedcba0987654321",
        pubKey: "abcdef1234567890abcdef1234567890abcdef12",
        action: "โอนกรรมสิทธิ์",
        detail: "โอนกรรมสิทธิ์ QR ไปยัง Public Key ใหม่"
      },
      {
        datetime: "2025-06-03T09:45:00Z",
        qrHash: "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
        pubKey: "1234567890abcdef1234567890abcdef12345678",
        action: "ปลดล็อก Master",
        detail: "Master ปลดล็อก QR"
      },
      {
        datetime: "2025-06-04T15:00:00Z",
        qrHash: "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
        pubKey: "9999999999999999999999999999999999999999",
        action: "โอนกรรมสิทธิ์",
        detail: "โอนกรรมสิทธิ์ QR ไปยัง Public Key ใหม่"
      }
    ];

    const qrSearchInput = document.getElementById('qrSearchInput');
    const clearBtn = document.getElementById('clearBtn');
    const ownerStatusDiv = document.getElementById('ownerStatus');
    const logList = document.getElementById('logList');
    const logListBody = document.getElementById('logListBody');
    const noDataMsg = document.getElementById('noDataMsg');

    function renderChain(qrHash) {
      const filtered = logs
        .filter(log => log.qrHash.toLowerCase() === qrHash.toLowerCase())
        .sort((a,b) => new Date(a.datetime) - new Date(b.datetime));

      if(filtered.length === 0) {
        logList.style.display = 'none';
        ownerStatusDiv.textContent = '';
        noDataMsg.style.display = 'block';
        noDataMsg.textContent = 'ไม่พบประวัติสำหรับ QR hash นี้';
        return;
      }

      noDataMsg.style.display = 'none';
      logList.style.display = 'table';

      const latest = filtered[filtered.length - 1];
      ownerStatusDiv.textContent = `เจ้าของปัจจุบัน: ${latest.pubKey}`;

      logListBody.innerHTML = '';
      filtered.forEach(log => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${new Date(log.datetime).toLocaleString()}</td>
          <td>${log.action}</td>
          <td>${log.detail}</td>
          <td><code>${log.pubKey}</code></td>
        `;
        logListBody.appendChild(tr);
      });
    }

    function validateInput() {
      const val = qrSearchInput.value.trim();
      if (val.length === 64) {
        renderChain(val);
      } else if(val.length === 0) {
        logList.style.display = 'none';
        ownerStatusDiv.textContent = '';
        noDataMsg.style.display = 'block';
        noDataMsg.textContent = 'กรุณาค้นหา QR hash เพื่อดูประวัติ';
        logListBody.innerHTML = '';
      } else {
        logList.style.display = 'none';
        ownerStatusDiv.textContent = '';
        noDataMsg.style.display = 'block';
        noDataMsg.textContent = 'กรุณากรอก QR hash ให้ครบ 64 ตัวอักษร';
        logListBody.innerHTML = '';
      }
    }

    qrSearchInput.addEventListener('input', validateInput);

    clearBtn.addEventListener('click', () => {
      qrSearchInput.value = '';
      ownerStatusDiv.textContent = '';
      logList.style.display = 'none';
      noDataMsg.style.display = 'block';
      noDataMsg.textContent = 'กรุณาค้นหา QR hash เพื่อดูประวัติ';
      logListBody.innerHTML = '';
      qrSearchInput.focus();
    });

    // เริ่มต้นแสดงข้อความแนะนำ
    noDataMsg.style.display = 'block';
  </script>
</body>
</html>
