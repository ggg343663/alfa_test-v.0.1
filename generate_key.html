<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate Public Key - DTC: Magic Chain System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 0 auto;
      padding: 1em 0.1em 4em 0.1em;
      background: #f5f7fa;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #219150;
      margin-bottom: 0.6em;
      font-size: 1.15em;
      letter-spacing: 0.01em;
    }
    h1 small {
      display: block;
      font-size: 0.7em;
      color: #555;
      margin-top: 0.3em;
    }
    .intro-section {
      background-color: #e0f2f7;
      border-left: 4px solid #00acc1;
      padding: 0.6em 1em;
      margin-bottom: 1.1em;
      border-radius: 8px;
      box-shadow: 0 1.5px 5px rgba(0,0,0,0.04);
      color: #444;
      font-size: 0.93em;
    }
    .section-block {
      margin: 0.7em 0;
      padding: 0.7em 0.8em;
      border-radius: 10px;
      box-shadow: 0 1.5px 6px #edf1f6;
    }
    .block-title {
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 0.6em;
      padding-bottom: 0.25em;
      border-bottom: 1px solid rgba(0,0,0,0.07);
      color: #444;
    }
    .key-input-block {
      background: #fffde7;
      border-left: 5px solid #ffd600;
    }
    .key-output-block {
      background: #eafaf0;
      border-left: 5px solid #219150;
    }
    .input-group {
      margin-bottom: 12px;
      position: relative;
    }
    .input-group label {
      display: block;
      margin-bottom: 3px;
      font-weight: bold;
      color: #666;
      font-size: 0.96em;
    }
    .input-group input[type="password"],
    .input-group input[type="text"] {
      width: 100%;
      padding: 9px;
      border: 1px solid #ddd;
      border-radius: 7px;
      font-size: 1em;
      background: #fff;
      box-sizing: border-box;
      transition: border-color 0.12s;
    }
    .input-group input:focus {
      border-color: #90a4ae;
      outline: none;
      background: #fcffeb;
    }
    .label-hint {
      display: block;
      font-size: 0.82em;
      color: #90a4ae;
      margin-top: 3px;
    }
    .toggle-password {
      position: absolute;
      right: 9px;
      top: 58%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #90a4ae;
      font-size: 0.85em;
      user-select: none;
    }
    .pin-dots {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 24px;
      margin-top: 7px;
    }
    .pin-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #e0e0e0;
      margin: 0 3px;
      transition: background-color 0.1s;
    }
    .pin-dot.active {
      background-color: #ffd600;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 0.6em 1em;
      margin-top: 12px;
      color: #fff;
      font-weight: bold;
      border-radius: 8px;
      font-size: 1.05em;
      text-align: center;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: background 0.13s, filter 0.13s;
      box-shadow: 0 1.5px 6px rgba(0,0,0,0.07);
      background: #2196f3;
    }
    .btn:hover { filter: brightness(0.94); }
    .output-box {
      background: #f0f4c3;
      border: 1px solid #cddc39;
      border-radius: 7px;
      padding: 9px;
      margin-top: 13px;
      word-wrap: break-word;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.95em;
      color: #444;
      position: relative;
    }
    .output-box label {
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    .public-key-value {
      background: #e6e6a1;
      padding: 6px;
      border-radius: 5px;
      user-select: all;
      display: block;
      margin-top: 4px;
      overflow-x: auto;
      font-size: 0.96em;
    }
    .timestamp-note {
      text-align: right;
      color: #607d8b;
      font-size: 0.83em;
      margin-top: 5px;
    }
    .footer-note {
      text-align: center;
      margin-top: 2em;
      color: #b0bec5;
      font-size: 0.91em;
    }
    .message-warning {
      color: #d84315;
      background: #fff3e0;
      border-radius: 7px;
      padding: 7px 12px;
      margin-top: 9px;
      font-size: 0.96em;
      text-align: center;
      display: none;
    }
    /* Sticky Navigation Bar */
    .navbar {
      display: flex;
      justify-content: space-around;
      padding: 7px 0;
      background: #ede7f6;
      border-radius: 9px 9px 0 0;
      box-shadow: 0 1.5px 7px rgba(0,0,0,0.05);
      position: fixed;
      left: 0; right: 0; bottom: 0;
      max-width: 700px;
      margin: 0 auto;
      z-index: 99;
    }
    .navbar a {
      flex: 1;
      text-align: center;
      padding: 10px 4px;
      text-decoration: none;
      color: #6a1b9a;
      font-weight: bold;
      border-radius: 5px;
      transition: background 0.18s, color 0.18s;
      margin: 0 2.5px;
      font-size: 0.97em;
    }
    .navbar a:hover {
      background: #d1c4e9;
      color: #4a148c;
    }
    .navbar a.active {
      background: #9575cd;
      color: white;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.18);
    }
    @media (max-width: 600px) {
      body { margin: 0.2em; padding: 0.1em 0.01em 4em 0.01em;}
      h1 { font-size: 1em; margin-bottom: 0.6em; }
      .intro-section { font-size: 0.88em; padding: 0.36em 0.7em; }
      .section-block { padding: 0.33em 0.2em; }
      .btn { font-size: 0.95em; padding: 0.42em 0.7em; }
      .input-group input { padding: 6px; font-size: 0.98em; }
      .block-title { font-size: 0.95em; }
      .footer-note { font-size: 0.81em; }
      .navbar { padding: 4px 0; }
      .navbar a { font-size: 0.91em; padding: 7px 2px;}
      .output-box { font-size: 0.93em; }
    }
  </style>
</head>
<body>
    <h1>DTC: Magic Chain System <br><small>Decentralized Trust Community</small></h1>

    <div class="intro-section">
        <p>Your <strong>Public Key</strong> is the foundation of your identity in DTC. It's derived from your unique Password and PIN, ensuring <strong>self-custody</strong> and security.</p>
        <p><strong>DTC does NOT store your Private Key.</strong> You control it completely.</p>
    </div>

    <div class="section-block key-input-block">
        <div class="block-title">Generate Your Public Key</div>

        <div class="input-group">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter your password" />
            <span class="toggle-password" data-target="password">Show</span>
            <span class="label-hint">Choose a strong, memorable password.</span>
        </div>
        <div class="input-group">
            <label for="confirmPassword">Confirm Password:</label>
            <input type="password" id="confirmPassword" placeholder="Re-enter your password" />
            <span class="toggle-password" data-target="confirmPassword">Show</span>
        </div>
        <div class="input-group">
            <label for="pin">PIN (4 digits):</label>
            <input type="password" id="pin" maxlength="4" placeholder="Enter your 4-digit PIN" />
            <span class="toggle-password" data-target="pin">Show</span>
            <div class="pin-dots" id="pinDots">
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
            </div>
            <span class="label-hint">A 4-digit PIN for additional security layer.</span>
        </div>
        <div class="input-group">
            <label for="confirmPin">Confirm PIN (4 digits):</label>
            <input type="password" id="confirmPin" maxlength="4" placeholder="Re-enter your 4-digit PIN" />
            <span class="toggle-password" data-target="confirmPin">Show</span>
            <span class="label-hint">Make sure both PINs match.</span>
        </div>
        <button class="btn" id="generateKeyBtn">Generate Public Key</button>
        <div id="msg" class="message-warning"></div>
    </div>

    <div class="section-block key-output-block" id="publicKeyOutputSection" style="display:none;">
        <div class="block-title">Your Generated Public Key</div>
        <div class="output-box">
            <label for="publicKey">Public Key:</label>
            <div class="public-key-value" id="publicKey"></div>
            <p class="timestamp-note">Generated at: <span id="generatedTimestamp"></span></p>
        </div>
        <span class="label-hint">Keep this Public Key for registering QR codes and other DTC operations.</span>
    </div>

    <p class="footer-note">
        Developed &amp; Deployed on GitHub Pages â€¢ 100% Mobile-Friendly System
    </p>
    <div class="navbar">
        <a href="index.html">Back</a>
        <a href="index.html" class="active">Home</a>
        <a href="mint_qr.html">Next</a>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const pinInput = document.getElementById('pin');
            const confirmPinInput = document.getElementById('confirmPin');
            const pinDotsContainer = document.getElementById('pinDots');
            const generateKeyBtn = document.getElementById('generateKeyBtn');
            const publicKeyOutputSection = document.getElementById('publicKeyOutputSection');
            const publicKeyDisplay = document.getElementById('publicKey');
            const generatedTimestamp = document.getElementById('generatedTimestamp');
            const msg = document.getElementById('msg');

            // --- Password/PIN Visibility Toggle ---
            document.querySelectorAll('.toggle-password').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const targetId = toggle.dataset.target;
                    const targetInput = document.getElementById(targetId);
                    if (targetInput.type === 'password') {
                        targetInput.type = 'text';
                        toggle.textContent = 'Hide';
                    } else {
                        targetInput.type = 'password';
                        toggle.textContent = 'Show';
                    }
                });
            });

            // --- PIN Dots Visual Feedback ---
            pinInput.addEventListener('input', updatePinDots);
            pinInput.addEventListener('focus', updatePinDots);
            pinInput.addEventListener('blur', updatePinDots);
            function updatePinDots() {
                const pinLength = pinInput.value.length;
                const dots = pinDotsContainer.querySelectorAll('.pin-dot');
                dots.forEach((dot, index) => {
                    if (index < pinLength) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
            }

            // --- Mock Public Key Generation Function ---
            function generatePublicKey(password, pin) {
                let str = password + pin + "DTC_Key_Salt_2025";
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash |= 0;
                }
                let mockPublicKey = Math.abs(hash).toString(16).padStart(16, '0');
                mockPublicKey += (Math.random() * 1e15).toString(16).padStart(12, '0');
                mockPublicKey += 'DTC-PUB';
                mockPublicKey = mockPublicKey.substring(0, 64);
                return "0x" + mockPublicKey.toUpperCase();
            }

            // --- Generate Public Key Button Click ---
            generateKeyBtn.addEventListener('click', () => {
                msg.style.display = 'none';
                msg.textContent = '';
                const password = passwordInput.value.trim();
                const confirmPassword = confirmPasswordInput.value.trim();
                const pin = pinInput.value.trim();
                const confirmPin = confirmPinInput.value.trim();

                // Basic validation
                if (!password || !confirmPassword || !pin || !confirmPin) {
                    showMsg('Please fill in all fields.');
                    return;
                }
                if (password !== confirmPassword) {
                    showMsg('Passwords do not match.');
                    return;
                }
                if (pin !== confirmPin) {
                    showMsg('PINs do not match.');
                    return;
                }
                if (pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                    showMsg('PIN must be 4 digits.');
                    return;
                }
                // Generate and display Public Key
                const newPublicKey = generatePublicKey(password, pin);
                publicKeyDisplay.textContent = newPublicKey;
                generatedTimestamp.textContent = new Date().toLocaleString();
                publicKeyOutputSection.style.display = 'block';
                msg.style.display = 'none';
            });

            function showMsg(txt) {
                msg.style.display = 'block';
                msg.textContent = txt;
            }
            updatePinDots();
        });
    </script>
</body>
</html>
