<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DTC – One Page Minimal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #f6f7fa; color: #333; margin: 0; padding: 0;}
    .container { max-width: 470px; background: #fff; margin: 28px auto; border-radius: 15px; box-shadow: 0 2px 16px #90caf933; padding: 2.2em 1.1em 2em 1.1em;}
    h2 { text-align: center; color: #246bfd; margin-bottom: 1.5em; font-size: 1.36em; font-weight: bold;}
    .section { margin-bottom: 1.25em; }
    .input-row { margin-bottom: 1.1em;}
    .input-label { font-weight: bold; color: #7e8b9a; margin-bottom: 0.19em;}
    .input-hint { color: #90a4ae; font-size: 0.96em; margin-top: 0.08em; margin-bottom: 0.18em;}
    input, select {
      width: 100%; min-height: 38px; max-height: 44px;
      font-size: 1.07em; border-radius: 8px; border: 1.6px solid #cfd8dc;
      padding: 0.7em 1em; background: #fffde7; transition: border .2s, background .2s;
      box-sizing: border-box;
    }
    input:focus, select:focus { border-color: #246bfd; background: #ffffff;}
    .action-bar { margin-top: 6px; margin-bottom: 0.7em;}
    .btn-main, .btn-export, .btn-nav, .btn-action {
      font-size: 1.11em; border-radius: 8px; border: none; font-weight: bold; min-height: 44px;
      margin: 6px 0 0 0; padding: 0.77em 0; display: block; width: 100%; cursor: pointer;
      transition: background .2s, color .2s;
    }
    .btn-main { background: #2196f3; color: #fff;}
    .btn-main:active { background: #1976d2;}
    .btn-export { background: #ffd600; color: #212121;}
    .btn-export:active { background: #ffb300;}
    .btn-action { background: #b8cafe; color: #173472;}
    .btn-action:active { background: #97b6ed;}
    .btn-nav { background: #ede7f6; color: #512da8;}
    .btn-nav:active { background: #b39ddb;}
    .row-flex { display: flex; gap: 8px;}
    .row-flex .col { flex: 1;}
    .output, .preview-box, .commitment-box, .audit-chain-box {
      background: #fafdff; border-radius: 8px; border: 1.2px solid #cfd8dc;
      padding: 0.7em 0.9em; margin-bottom: 0.9em; font-size: 1em; min-height: 38px;
      word-break: break-all; overflow-x: auto;
    }
    .preview-box { max-height: 90px; margin-bottom: 0.5em;}
    .commitment-box { color: #2979ff; font-size: 0.99em;}
    .audit-chain-box { color: #8c7ae6; font-size: 0.99em; display: none;}
    .error { color: #e74c3c; font-size: 1em; margin-bottom: 0.9em;}
    .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-top: 32px; gap: 8px;}
    @media (max-width: 530px) {
      .container { padding: 1em 0.2em 1.3em 0.2em;}
      .btn-main, .btn-nav, .btn-export { font-size: 0.99em; min-height: 38px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>DTC – One Page Minimal QR Batch</h2>

    <!-- Section A: Key & Batch Info -->
    <div class="section">
      <div class="input-row">
        <div class="input-label">Password</div>
        <input id="pw" type="password" autocomplete="new-password" placeholder="Password (8-12 ตัว, ตัวเลข/อังกฤษ)" />
        <div class="input-hint">ต้องมีทั้งตัวอักษรและตัวเลข</div>
      </div>
      <div class="input-row">
        <div class="input-label">PIN</div>
        <input id="pin" type="password" maxlength="6" placeholder="PIN (6 ตัวเลข)" autocomplete="off"/>
        <div class="input-hint">PIN 6 หลัก</div>
      </div>
      <div class="input-row">
        <div class="input-label">Secret</div>
        <input id="secret" type="text" placeholder="Secret Code หรือปล่อยว่าง"/>
        <div class="input-hint">ระบุหรือไม่ก็ได้ (optional)</div>
      </div>
      <div class="input-row">
        <div class="input-label">Batch Name</div>
        <input id="batch" type="text" placeholder="เช่น: FirstEdition, Maple100"/>
        <div class="input-hint">สำหรับอ้างอิงภายหลัง (optional)</div>
      </div>
      <div class="input-row row-flex">
        <div class="col">
          <div class="input-label">จำนวน QR</div>
          <input id="qty" type="number" min="1" max="100" value="10"/>
        </div>
        <div class="col" style="align-self: flex-end;">
          <button class="btn-main" style="width: 100%;" onclick="changeQty(1)">+</button>
          <button class="btn-main" style="width: 100%; margin-top: 2px;" onclick="changeQty(-1)">–</button>
        </div>
      </div>
    </div>

    <!-- Section B: Action -->
    <div class="section action-bar">
      <button class="btn-main" onclick="generateBatch()">Generate QR Batch</button>
    </div>

    <!-- Section C: ผลลัพธ์/Preview/Export -->
    <div class="section">
      <div class="preview-box" id="qr-preview" style="display: none;"></div>
      <div class="commitment-box" id="commitment-box" style="display: none;"></div>
      <div style="display: flex; gap: 8px;">
        <button class="btn-export" style="flex: 1;" onclick="exportTicket()" id="btn-export-ticket">Export Ticket</button>
        <button class="btn-action" style="flex: 1;" onclick="exportQR()" id="btn-export-qr">Export QR</button>
        <button class="btn-action" style="flex: 1;" onclick="exportCommitmentLog()" id="btn-export-commit">Export Log</button>
      </div>
    </div>

    <!-- Section D: Regen QR -->
    <div class="section">
      <div class="input-row">
        <div class="input-label">Ticket (txt/json)</div>
        <input type="text" id="ticket" placeholder="วาง ticket หรือ upload"/>
      </div>
      <div class="input-row">
        <div class="input-label">Password + PIN + Secret (อีกครั้ง)</div>
        <input id="pw2" type="password" placeholder="Password"/>
        <input id="pin2" type="password" maxlength="6" placeholder="PIN"/>
        <input id="secret2" type="text" placeholder="Secret"/>
      </div>
      <button class="btn-main" onclick="regenQR()">Regen QR</button>
      <div class="preview-box" id="regen-preview" style="display:none;"></div>
      <div class="commitment-box" id="regen-commit" style="display:none;"></div>
    </div>

    <!-- Section E: Audit Chain -->
    <div class="section">
      <div class="input-row">
        <div class="input-label">QR/Commitment Hash</div>
        <input id="audit-hash" type="text" placeholder="วาง hash ที่ต้องการ audit"/>
      </div>
      <button class="btn-action" onclick="auditChain()">Audit Chain</button>
      <div class="audit-chain-box" id="audit-chain-box"></div>
    </div>

    <!-- Section F: Navigation -->
    <div class="nav-bar">
      <button class="btn-nav" onclick="history.back()">Back</button>
      <a class="btn-nav" href="index.html">Home</a>
      <button class="btn-nav" onclick="alert('Next step coming soon!')">Next</button>
    </div>

    <div id="error" class="error" style="display:none;"></div>
  </div>
  <script>
    // Utility: Change QR amount
    function changeQty(val) {
      let qty = parseInt(document.getElementById('qty').value) || 1;
      qty += val;
      if (qty < 1) qty = 1;
      if (qty > 100) qty = 100;
      document.getElementById('qty').value = qty;
    }

    // Generate QR Batch: mockup
    function generateBatch() {
      const pw = document.getElementById('pw').value, pin = document.getElementById('pin').value, secret = document.getElementById('secret').value;
      const batch = document.getElementById('batch').value, qty = parseInt(document.getElementById('qty').value);
      let error = '';
      if (!pw || pw.length < 8) error = "Password อย่างน้อย 8 ตัว";
      if (!pin || pin.length !== 6 || !/^\d+$/.test(pin)) error = "PIN ต้องเป็นตัวเลข 6 หลัก";
      if (error) return showError(error);

      // MOCKUP hash logic – demo only!
      let hashes = [];
      for (let i=1; i<=qty; ++i) hashes.push("QR" + i + ": " + sha256(pw + pin + secret + batch + i));
      document.getElementById('qr-preview').innerHTML = hashes.slice(0, 4).join('<br>') + (qty>4 ? '<div style="font-size:0.92em;">…and '+(qty-4)+' more</div>' : '');
      document.getElementById('qr-preview').style.display = '';
      document.getElementById('commitment-box').textContent = "Commitment: " + sha256(pw+pin+secret+batch+qty);
      document.getElementById('commitment-box').style.display = '';
      hideError();
    }

    // Export stubs
    function exportTicket(){alert("Export Ticket: Coming soon!");}
    function exportQR(){alert("Export QR: Coming soon!");}
    function exportCommitmentLog(){alert("Export Log: Coming soon!");}
    function regenQR(){
      document.getElementById('regen-preview').innerHTML = "Regen QR: (ตัวอย่าง) " + new Date().toISOString();
      document.getElementById('regen-preview').style.display = '';
      document.getElementById('regen-commit').textContent = "Commitment: (ตัวอย่าง)";
      document.getElementById('regen-commit').style.display = '';
    }
    function auditChain(){
      const hash = document.getElementById('audit-hash').value.trim();
      if (!hash) return showError("กรุณากรอก hash");
      document.getElementById('audit-chain-box').textContent = "Audit Chain: (mockup) " + hash.substr(0,12) + "…";
      document.getElementById('audit-chain-box').style.display = '';
      hideError();
    }

    // Simple SHA-256 mock (DEMO only)
    function sha256(str) {
      // Fake hash for demo UI only!
      let h=5381; for(let i=0;i<str.length;i++) h=((h<<5)+h)+str.charCodeAt(i); return ("00000"+(h>>>0).toString(16)).slice(-10);
    }

    function showError(msg) {
      document.getElementById('error').textContent = msg;
      document.getElementById('error').style.display = '';
    }
    function hideError() {
      document.getElementById('error').style.display = 'none';
    }
  </script>
</body>
</html>
