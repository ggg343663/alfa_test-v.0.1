<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generate Public Key – DTC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #f6f7fa; color: #333; margin: 0; padding: 0; }
    .container { max-width: 430px; background: #fff; margin: 30px auto 0 auto; border-radius: 15px; box-shadow: 0 2px 16px #90caf933; padding: 2.3em 1.1em 1.5em 1.1em; }
    h2 { text-align: center; color: #246bfd; margin-bottom: 1.5em; font-size: 1.5em; font-weight: bold; }
    .input-row { margin-bottom: 1.1em; }
    .input-label { margin-bottom: 0.28em; font-weight: bold; color: #7e8b9a; font-size: 1.09em; }
    .pw-group { position: relative; }
    .pw-input, .pin-input {
      width: 100%; min-height: 44px; max-height: 48px; 
      padding: 0.83em 2.1em 0.83em 1em;
      font-size: 1.11em; border-radius: 9px; box-sizing: border-box;
      border: 2px solid #ffe082;
      background: #fffde7;
      transition: border .2s, background .2s;
    }
    .pw-input:focus, .pin-input:focus { border-color: #246bfd; background: #ffffff; }
    .show-btn { position: absolute; right: 0.55em; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; width: 26px; height: 26px; padding: 0;}
    .show-btn svg { display: block; }
    .show-btn .eye-hide { display: none;}
    .show-btn.hide .eye-show { display: none;}
    .show-btn.hide .eye-hide { display: block;}
    .input-hint { color: #b0bec5; font-size: 0.96em; margin-top: 0.05em;}
    .strength-bar { width: 100%; height: 7px; border-radius: 4px; margin: 0.28em 0 0.15em 0; background: #ffe4e0; transition: background 0.3s;}
    .strength-bar.weak { background: #ff6b6b; }
    .strength-bar.medium { background: #ffd700; }
    .strength-bar.strong { background: #64dd17; }
    .strength { font-size: 1em; margin-bottom: 0.1em; margin-top: 0.05em;}
    .strength.weak { color: #ff6b6b; }
    .strength.medium { color: #ffb300; }
    .strength.strong { color: #4caf50; }
    .error { color: #e74c3c; font-size: 1em; margin-bottom: 0.8em; text-align: left; }
    .output { background: #f7fafd; border-left: 5px solid #90caf9; padding: 0.77em 0.8em; border-radius: 8px; margin: 1.2em 0 0.7em 0; font-size: 1em; display: none; }
    .publickey-box { display: flex; align-items: center; background: #fafdff; border-radius: 6px; border: 1.2px solid #cfd8dc; padding: 0.44em; margin-top: 0.2em;}
    .publickey-box span { flex: 1; word-break: break-all; font-size: 0.98em;}
    .copy-btn { margin-left: 0.7em; padding: 0.28em 1em; background: #4caf50; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.98em; }
    .copy-btn:active { background: #219150; }
    .timestamp-row { color: #26733e; font-size: 0.93em; margin-top: 0.11em;}
    .btn-main { display: block; width: 100%; font-size: 1.15em; border-radius: 8px; border: none; font-weight: bold; min-height: 48px; margin: 16px 0 7px 0; }
    #gen-key-btn { background: #2d995b; color: #fff;}
    #gen-key-btn:active { background: #196c34; }
    #next-btn { background: #b8cafe; color: #173472; margin-top: 9px;}
    #next-btn:active { background: #97b6ed;}
    .back-home-bar { display: flex; flex-direction: row; justify-content: center; align-items: center; margin-top: 26px; }
    #back-home-btn { background: #ede7f6; color: #512da8; border: none; border-radius: 10px; padding: 0.95em 1.5em; font-size: 1.14em; text-align: center; min-width: 150px; font-weight: bold; text-decoration: none; }
    #back-home-btn:active { background: #b39ddb;}
    @media (max-width: 480px) {
      .container { padding: 1.1em 0.22em 1em 0.22em;}
      .btn-main, #back-home-btn { font-size: 1em; min-height: 42px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>1. Generate Public Key from<br>Password + PIN</h2>
    <div class="input-row">
      <div class="input-label">Password:</div>
      <div class="pw-group">
        <input type="password" id="password" class="pw-input" placeholder="6-12 chars, letters & numbers" autocomplete="new-password"/>
        <button class="show-btn" type="button" onclick="toggleShow('password',this)" aria-label="Show Password">
          <span class="eye-icon">
            <svg class="eye-show" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
            </svg>
            <svg class="eye-hide" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
              <line x1="5" y1="5" x2="19" y2="19" />
            </svg>
          </span>
        </button>
      </div>
      <div class="input-hint">Password must include both letters and numbers.</div>
      <div id="strength-bar" class="strength-bar weak"></div>
      <div id="password-strength-msg" class="strength weak">Weak</div>
    </div>
    <div class="input-row">
      <div class="input-label">Confirm Password:</div>
      <div class="pw-group">
        <input type="password" id="confirm-password" class="pw-input" placeholder="Confirm password" autocomplete="new-password"/>
        <button class="show-btn" type="button" onclick="toggleShow('confirm-password',this)" aria-label="Show Confirm Password">
          <span class="eye-icon">
            <svg class="eye-show" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
            </svg>
            <svg class="eye-hide" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
              <line x1="5" y1="5" x2="19" y2="19" />
            </svg>
          </span>
        </button>
      </div>
    </div>
    <div class="input-row">
      <div class="input-label">PIN (4-6 digits):</div>
      <div class="pw-group">
        <input type="password" id="pin" class="pin-input" placeholder="Enter PIN (4-6 digits)" maxlength="6" autocomplete="off"/>
        <button class="show-btn" type="button" onclick="toggleShow('pin',this)" aria-label="Show PIN">
          <span class="eye-icon">
            <svg class="eye-show" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
            </svg>
            <svg class="eye-hide" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
              <line x1="5" y1="5" x2="19" y2="19" />
            </svg>
          </span>
        </button>
      </div>
      <div class="input-hint">PIN should be 4-6 digits.</div>
    </div>
    <div class="input-row">
      <div class="input-label">Confirm PIN:</div>
      <div class="pw-group">
        <input type="password" id="confirm-pin" class="pin-input" placeholder="Confirm PIN" maxlength="6" autocomplete="off"/>
        <button class="show-btn" type="button" onclick="toggleShow('confirm-pin',this)" aria-label="Show Confirm PIN">
          <span class="eye-icon">
            <svg class="eye-show" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
            </svg>
            <svg class="eye-hide" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="#222" stroke-width="2" viewBox="0 0 24 24">
              <ellipse cx="12" cy="12" rx="9" ry="5.5" />
              <circle cx="12" cy="12" r="2.5"/>
              <line x1="5" y1="5" x2="19" y2="19" />
            </svg>
          </span>
        </button>
      </div>
    </div>
    <div id="error-msg" class="error" style="display:none;"></div>

    <!-- Action Button -->
    <button id="gen-key-btn" class="btn-main">Generate Key</button>
<a href="create_qr_hash.html" id="next-btn" class="btn-main" style="background: #b8cafe; color:#173472;">Next: Generate QR Hash</a>html" id="next-btn" class="btn-main" style="background: #b8cafe; color:#173472;">Next: Generate QR Hash</a>qr.html" id="next-btn" class="btn-main" style="background: #b8cafe; color:#173472;">Next: Generate QR Hash</a>

    <!-- ผลลัพธ์ Public Key -->
    <div id="output-container" class="output">
      <div><b>Public Key:</b></div>
      <div class="publickey-box">
        <span id="public-key"></span>
        <button class="copy-btn" onclick="copyPubKey()">Copy</button>
      </div>
      <div class="timestamp-row" id="timestamp-row"></div>
    </div>

    <div class="back-home-bar">
      <a href="index.html" id="back-home-btn">Back to Home</a>
    </div>
  </div>

  <script>
    // Toggle show/hide password fields
    function toggleShow(id, btn) {
      const input = document.getElementById(id);
      if (input.type === "password") {
        input.type = "text";
        btn.classList.add('hide');
      } else {
        input.type = "password";
        btn.classList.remove('hide');
      }
    }
    // Password strength check
    const passwordInput = document.getElementById('password');
    passwordInput.addEventListener('input', checkPasswordStrength);
    function checkPasswordStrength() {
      const pw = passwordInput.value;
      let strength = 'weak', msg = 'Weak', barClass = 'strength-bar weak';
      if (pw.length >= 8 && /[A-Za-z]/.test(pw) && /\d/.test(pw) && pw.length <= 12) {
        if (/[A-Z]/.test(pw) && /[a-z]/.test(pw) && /\W/.test(pw)) {
          strength = 'strong'; msg = 'Strong'; barClass = 'strength-bar strong';
        } else { strength = 'medium'; msg = 'Medium'; barClass = 'strength-bar medium'; }
      } else if (pw.length >= 6 && /[A-Za-z]/.test(pw) && /\d/.test(pw)) {
        strength = 'medium'; msg = 'Medium'; barClass = 'strength-bar medium';
      }
      document.getElementById('strength-bar').className = barClass;
      document.getElementById('password-strength-msg').className = 'strength ' + strength;
      document.getElementById('password-strength-msg').textContent = msg;
    }
    // SHA-256 offline (Web Crypto API)
    async function sha256(str) {
      const buf = new TextEncoder().encode(str);
      const hashBuf = await crypto.subtle.digest('SHA-256', buf);
      return Array.from(new Uint8Array(hashBuf)).map(b => b.toString(16).padStart(2, '0')).join('');
    }
    // Copy Public Key
    function copyPubKey() {
      const pk = document.getElementById('public-key').textContent;
      navigator.clipboard.writeText(pk);
    }
    // Validate & Generate Key
    document.getElementById('gen-key-btn').onclick = async function () {
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const pin = document.getElementById('pin').value;
      const confirmPin = document.getElementById('confirm-pin').value;
      const errorMsg = document.getElementById('error-msg');
      errorMsg.style.display = "none";
      if (!password || password.length < 6 || password.length > 12 || !(/[A-Za-z]/.test(password) && /\d/.test(password))) {
        errorMsg.textContent = "Password must be 6-12 chars, include letters and numbers.";
        errorMsg.style.display = "block"; return;
      }
      if (password !== confirmPassword) {
        errorMsg.textContent = "Passwords do not match."; errorMsg.style.display = "block"; return;
      }
      if (!pin || !/^\d{4,6}$/.test(pin)) {
        errorMsg.textContent = "PIN must be 4-6 digits."; errorMsg.style.display = "block"; return;
      }
      if (pin !== confirmPin) {
        errorMsg.textContent = "PINs do not match."; errorMsg.style.display = "block"; return;
      }
      // Generate Public Key (offline)
      const publicKey = await sha256(password + '|' + pin);
      document.getElementById('public-key').textContent = publicKey;
      document.getElementById('timestamp-row').textContent = "Timestamp: " + new Date().toISOString();
      document.getElementById('output-container').style.display = "block";
    };
  </script>
</body>
</html>
