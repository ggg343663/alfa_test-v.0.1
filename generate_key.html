<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Generate Public Key - DTC</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; padding: 1.3em; max-width: 480px; margin: 0 auto;}
    h1 { color: #219150; text-align: center; margin-bottom: 1.2em; font-size: 1.15em;}
    .form-group { margin-bottom: 1em; }
    label { font-weight: bold; color: #2d3c35; margin-bottom: 0.35em; display:block;}
    input[type="password"], .pubkey-box {
      width: 100%; padding: 11px 12px; font-size: 1em; border: 2px solid #cfd8dc;
      border-radius: 9px; box-sizing: border-box; background: #fff;
      margin-top: 0.13em; transition: border 0.15s;
    }
    input:focus { border-color: #ffd600; background: #ffffed; }
    input.valid { border-color: #43a047;}
    input.invalid { border-color: #e53935;}
    .pubkey-box {
      background: #eafaf0; color: #222; margin-top: 1.05em;
      font-family: 'Courier New', monospace; min-height: 39px; font-size: 0.98em;
      border-color: #219150; display: flex; align-items: center; justify-content: space-between;
      transition: border 0.18s;
      padding: 10px 12px;
    }
    .pubkey-box.copied { border-color: #43a047; background: #f0fff0;}
    .copy-btn {
      background: #2196f3; color: #fff; border: none; border-radius: 8px;
      padding: 6px 14px; font-size: 0.95em; cursor: pointer; font-weight: bold; margin-left: 10px;
    }
    .copy-btn:active { filter: brightness(0.95);}
    .copy-status { color: #43a047; font-size: 0.97em; margin-left: 8px; opacity: 0; transition: opacity 0.18s;}
    .copy-status.visible { opacity: 1;}
    .strength-bar { height: 7px; width: 100%; margin-top: 4px; border-radius: 5px; background: #f5f5f5; overflow: hidden;}
    .strength-inner { height: 100%; width: 0; border-radius: 5px; transition: width 0.22s;}
    .btn-gen {
      width: 100%; background: #2196f3; color: #fff; border: none; border-radius: 8px;
      padding: 11px 0; font-size: 1.08em; font-weight: bold; margin-top: 0.7em; cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.09); transition: background 0.13s;
    }
    .btn-gen:active { background: #1976d2;}
    .btn-gen:disabled { opacity: 0.6; cursor: not-allowed;}
    @media (max-width: 600px) {
      body { padding: 1em 0.08em;}
      h1 { font-size: 1em;}
      .copy-btn { padding: 5px 9px;}
      .pubkey-box { font-size: 0.93em;}
      .btn-gen { padding: 10px 0;}
    }
  </style>
</head>
<body>
  <h1>Generate Public Key (DTC)</h1>
  <div class="form-group">
    <label>Password</label>
    <input type="password" id="password" maxlength="12" autocomplete="new-password" placeholder="6-12 chars (a-z,0-9)"/>
    <div class="strength-bar"><div id="pw-strength" class="strength-inner"></div></div>
  </div>
  <div class="form-group">
    <label>Confirm Password</label>
    <input type="password" id="confirmPassword" maxlength="12" autocomplete="new-password" placeholder="Confirm"/>
  </div>
  <div class="form-group">
    <label>PIN</label>
    <input type="password" id="pin" maxlength="4" pattern="\d*" inputmode="numeric" placeholder="4 digits (0-9)"/>
  </div>
  <div class="form-group">
    <label>Confirm PIN</label>
    <input type="password" id="confirmPin" maxlength="4" pattern="\d*" inputmode="numeric" placeholder="Confirm"/>
  </div>
  <button class="btn-gen" id="generateBtn">Generate Public Key</button>
  <div class="form-group" id="pubkeyArea" style="display:none;">
    <div class="pubkey-box" id="pubkeyBox">
      <span id="publicKeyPlaceholder">Public Key will appear here</span>
      <button class="copy-btn" id="copyBtn">Copy</button>
      <span id="copyStatus" class="copy-status"></span>
    </div>
  </div>
  <script>
    function validPw(pw) {
      return /^[a-zA-Z0-9]{6,12}$/.test(pw);
    }
    function validPin(pin) {
      return /^\d{4}$/.test(pin);
    }
    function genKey(password, pin) {
      // ไม่มี salt!
      let str = password + pin;
      let hash = 0;
      for (let i = 0; i < str.length; i++)
        hash = ((hash << 5) - hash) + str.charCodeAt(i), hash |= 0;
      let pub = Math.abs(hash).toString(16).padStart(16,'0') + 'DTC';
      return pub.slice(0, 48);
    }
    function pwStrength(pw) {
      if(!pw) return 0;
      let s = 0;
      if(pw.length >= 6) s++;
      if(/[A-Z]/.test(pw)) s++;
      if(/[a-z]/.test(pw)) s++;
      if(/\d/.test(pw)) s++;
      if(pw.length > 9) s++;
      return Math.min(s, 4);
    }
    function updateStrength() {
      const pw = document.getElementById('password').value;
      const bar = document.getElementById('pw-strength');
      const lvl = pwStrength(pw);
      bar.style.width = (25*lvl) + '%';
      bar.style.background = lvl >= 4 ? '#43a047' : lvl >= 3 ? '#ffd600' : lvl ? '#ffa726' : '#eee';
    }
    function feedback(id, isValid) {
      const input = document.getElementById(id);
      if(isValid === true) {
        input.classList.add('valid'); input.classList.remove('invalid');
      } else if(isValid === false) {
        input.classList.remove('valid'); input.classList.add('invalid');
      } else {
        input.classList.remove('valid','invalid');
      }
    }
    function validateInputs() {
      const pw = document.getElementById('password').value.trim();
      const cpw = document.getElementById('confirmPassword').value.trim();
      const pin = document.getElementById('pin').value.trim();
      const cpin = document.getElementById('confirmPin').value.trim();
      feedback('password', validPw(pw));
      feedback('confirmPassword', (cpw.length > 0 && cpw === pw && validPw(cpw)));
      feedback('pin', validPin(pin));
      feedback('confirmPin', (cpin.length > 0 && cpin === pin && validPin(cpin)));
      updateStrength();
      return (validPw(pw) && cpw === pw && validPin(pin) && cpin === pin);
    }
    ['password','confirmPassword','pin','confirmPin'].forEach(id => {
      document.getElementById(id).addEventListener('input', validateInputs);
    });
    document.getElementById('generateBtn').onclick = function() {
      if (!validateInputs()) return;
      const pw = document.getElementById('password').value.trim();
      const pin = document.getElementById('pin').value.trim();
      let pubkey = genKey(pw, pin);
      document.getElementById('publicKeyPlaceholder').textContent = pubkey;
      document.getElementById('pubkeyArea').style.display = '';
    };
    document.getElementById('copyBtn').onclick = function() {
      navigator.clipboard.writeText(document.getElementById('publicKeyPlaceholder').textContent);
      const pubkeyBox = document.getElementById('pubkeyBox');
      const copyStatus = document.getElementById('copyStatus');
      copyStatus.textContent = '✓ Copied!';
      copyStatus.classList.add('visible');
      pubkeyBox.classList.add('copied');
      setTimeout(()=>{copyStatus.classList.remove('visible'); pubkeyBox.classList.remove('copied');}, 1100);
    };
    validateInputs();
  </script>
</body>
</html>
