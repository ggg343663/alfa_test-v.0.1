<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Generate Public Key - DTC</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; padding: 1.3em; max-width: 480px; margin: 0 auto;}
    h1 { color: #219150; text-align: center; margin-bottom: 1.1em; font-size: 1.13em;}
    .form-group { margin-bottom: 1.05em; }
    label { font-weight: bold; color: #2d3c35;}
    .input-box { position: relative; display: flex; align-items: center; }
    input[type="password"], .pubkey-box {
      width: 100%; padding: 9px 11px 9px 40px; font-size: 1em; border: 2px solid #cfd8dc;
      border-radius: 9px; box-sizing: border-box; background: #fff;
      margin-top: 0.3em; transition: border 0.15s;
    }
    input:focus { border-color: #ffd600; background: #ffffed; }
    .input-svg {
      position: absolute; left: 9px; top: 50%; transform: translateY(-50%);
      width: 22px; height: 22px; pointer-events: none;
    }
    .status-svg {
      position: absolute; right: 9px; top: 50%; transform: translateY(-50%);
      width: 20px; height: 20px; pointer-events: none;
      opacity: 0; transition: opacity 0.16s;
    }
    input.valid { border-color: #43a047;}
    input.invalid { border-color: #e53935;}
    .status-svg.visible { opacity: 1;}
    .pubkey-box {
      background: #eafaf0; color: #222; margin-top: 1.1em;
      font-family: 'Courier New', monospace; min-height: 38px; font-size: 0.97em;
      border-color: #219150; display: flex; align-items: center; justify-content: space-between;
      transition: border 0.18s;
    }
    .pubkey-box.copied { border-color: #43a047; background: #f0fff0;}
    .copy-btn {
      background: #2196f3; color: #fff; border: none; border-radius: 8px;
      padding: 6px 14px; font-size: 0.95em; cursor: pointer; font-weight: bold; margin-left: 10px;
    }
    .copy-btn:active { filter: brightness(0.95);}
    .copy-status { color: #43a047; font-size: 0.97em; margin-left: 8px; opacity: 0; transition: opacity 0.18s;}
    .copy-status.visible { opacity: 1;}
    .note { color: #9e9e9e; font-size: 0.95em; margin: 1em 0;}
    @media (max-width: 600px) {
      body { padding: 1em 0.08em;}
      h1 { font-size: 1em;}
      .copy-btn { padding: 5px 9px;}
      .pubkey-box { font-size: 0.91em;}
    }
  </style>
</head>
<body>
  <h1>Generate Public Key (DTC)</h1>
  <div class="form-group">
    <label>Password</label>
    <div class="input-box">
      <span class="input-svg">
        <svg width="20" height="22"><text x="2" y="16" font-size="13" font-family="monospace" fill="#90a4ae">abc</text></svg>
      </span>
      <input type="password" id="password" maxlength="24" autocomplete="new-password" placeholder="Password"/>
      <span class="status-svg" id="pw-status"></span>
    </div>
  </div>
  <div class="form-group">
    <label>Confirm Password</label>
    <div class="input-box">
      <span class="input-svg">
        <svg width="20" height="22"><text x="2" y="16" font-size="13" font-family="monospace" fill="#90a4ae">abc</text></svg>
      </span>
      <input type="password" id="confirmPassword" maxlength="24" autocomplete="new-password" placeholder="Confirm Password"/>
      <span class="status-svg" id="cpw-status"></span>
    </div>
  </div>
  <div class="form-group">
    <label>PIN (4 digits)</label>
    <div class="input-box">
      <span class="input-svg">
        <svg width="23" height="22"><text x="1" y="16" font-size="13" font-family="monospace" fill="#90a4ae">1234</text></svg>
      </span>
      <input type="password" id="pin" maxlength="4" pattern="\d*" inputmode="numeric" placeholder="1234"/>
      <span class="status-svg" id="pin-status"></span>
    </div>
  </div>
  <div class="form-group">
    <label>Confirm PIN</label>
    <div class="input-box">
      <span class="input-svg">
        <svg width="23" height="22"><text x="1" y="16" font-size="13" font-family="monospace" fill="#90a4ae">1234</text></svg>
      </span>
      <input type="password" id="confirmPin" maxlength="4" pattern="\d*" inputmode="numeric" placeholder="Confirm PIN"/>
      <span class="status-svg" id="cpin-status"></span>
    </div>
  </div>
  <div class="form-group">
    <div class="pubkey-box" id="pubkeyBox">
      <span id="publicKeyPlaceholder" style="color:#90a4ae;">Public Key will appear here</span>
      <button class="copy-btn" id="copyBtn" style="display:none;">Copy</button>
      <span id="copyStatus" class="copy-status"></span>
    </div>
  </div>
  <div class="note">
    *Your public key is generated deterministically from password + PIN.<br>
    (We never store or know your private key)
  </div>
  <script>
    function validPw(pw) { return pw.length>=6 && pw.length<=16; }
    function validPin(pin) { return /^\d{4}$/.test(pin); }
    function genKey(password, pin) {
      let str = password + pin + "DTC_Key_Salt";
      let hash = 0;
      for (let i = 0; i < str.length; i++) hash = ((hash << 5) - hash) + str.charCodeAt(i), hash |= 0;
      let pub = Math.abs(hash).toString(16).padStart(16,'0') + 'DTC';
      return pub.slice(0, 48);
    }
    // Validate + feedback
    function feedback(id, isValid) {
      const input = document.getElementById(id);
      const svg = document.getElementById(id+'-status');
      if(isValid === true) {
        input.classList.add('valid'); input.classList.remove('invalid');
        svg.innerHTML = `<svg width="20" height="20"><polyline points="5,12 10,17 17,6" fill="none" stroke="#43a047" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
        svg.classList.add('visible');
      } else if(isValid === false) {
        input.classList.remove('valid'); input.classList.add('invalid');
        svg.innerHTML = `<svg width="20" height="20"><line x1="6" y1="6" x2="16" y2="16" stroke="#e53935" stroke-width="2.2"/><line x1="16" y1="6" x2="6" y2="16" stroke="#e53935" stroke-width="2.2"/></svg>`;
        svg.classList.add('visible');
      } else {
        input.classList.remove('valid','invalid');
        svg.innerHTML = ``; svg.classList.remove('visible');
      }
    }
    // Update all fields + pubkey
    function updateAll() {
      const pw = document.getElementById('password').value.trim();
      const cpw = document.getElementById('confirmPassword').value.trim();
      const pin = document.getElementById('pin').value.trim();
      const cpin = document.getElementById('confirmPin').value.trim();
      feedback('password', validPw(pw));
      feedback('confirmPassword', (cpw.length > 0 && cpw === pw && validPw(cpw)));
      feedback('pin', validPin(pin));
      feedback('confirmPin', (cpin.length > 0 && cpin === pin && validPin(cpin)));
      const pubkeyBox = document.getElementById('pubkeyBox');
      const publicKeyPlaceholder = document.getElementById('publicKeyPlaceholder');
      const copyBtn = document.getElementById('copyBtn');
      // เงื่อนไขต้องตรงกันหมด
      if (validPw(pw) && cpw === pw && validPin(pin) && cpin === pin) {
        let pubkey = genKey(pw, pin);
        publicKeyPlaceholder.textContent = pubkey;
        copyBtn.style.display = '';
        pubkeyBox.classList.remove('copied');
      } else {
        publicKeyPlaceholder.textContent = 'Public Key will appear here';
        copyBtn.style.display = 'none';
      }
    }
    ['password','confirmPassword','pin','confirmPin'].forEach(id => {
      document.getElementById(id).addEventListener('input', updateAll);
    });
    // Copy logic
    document.getElementById('copyBtn').onclick = function() {
      navigator.clipboard.writeText(document.getElementById('publicKeyPlaceholder').textContent);
      const pubkeyBox = document.getElementById('pubkeyBox');
      const copyStatus = document.getElementById('copyStatus');
      copyStatus.textContent = '✓ Copied!';
      copyStatus.classList.add('visible');
      pubkeyBox.classList.add('copied');
      setTimeout(()=>{copyStatus.classList.remove('visible'); pubkeyBox.classList.remove('copied');}, 1100);
    };
    updateAll();
  </script>
</body>
</html>
