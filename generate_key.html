<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate Public Key - DTC: Magic Chain System</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 700px;
      margin: 0 auto;
      padding: 1em 0.1em 4em 0.1em;
      background: #f5f6fa;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #219150;
      margin-bottom: 0.8em;
      font-size: 1.2em;
      letter-spacing: 0.01em;
    }
    h1 small {
      display: block;
      font-size: 0.7em;
      color: #555;
      margin-top: 0.2em;
    }
    .section-block {
      margin: 0.7em 0;
      padding: 0.7em 0.8em;
      border-radius: 10px;
      box-shadow: 0 1.5px 6px #edf1f6;
    }
    .block-title {
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 0.5em;
      color: #444;
      padding-bottom: 0.13em;
      border-bottom: 1px solid rgba(0,0,0,0.07);
    }
    .key-input-block { background: #fffde7; border-left: 5px solid #ffd600;}
    .key-output-block { background: #eafaf0; border-left: 5px solid #219150;}
    .input-group { margin-bottom: 10px; position: relative;}
    .input-symbol { font-size: 1.18em; vertical-align: middle; margin-left: 3px;}
    .status-icon {
      position: absolute; right: 38px; top: 50%;
      transform: translateY(-50%);
      font-size: 1.15em;
      transition: color 0.18s;
      min-width: 1.3em; text-align: center;
    }
    .input-group input {
      width: 100%;
      padding: 8px 34px 8px 8px;
      border-radius: 7px;
      font-size: 1em;
      border: 1.6px solid #ccc;
      transition: border 0.14s;
      background: #fff;
      box-sizing: border-box;
    }
    .input-group input:focus { border-color: #ffd600; background: #ffffed;}
    .input-group input.valid { border-color: #43a047; }
    .input-group input.invalid { border-color: #e53935; background: #fff4f4;}
    .status-icon.valid { color: #43a047; }
    .status-icon.invalid { color: #e53935; }
    .status-icon.pending { color: #ffd600;}
    .toggle-password {
      position: absolute;
      right: 10px; top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #bbb;
      font-size: 1.12em;
      user-select: none;
      z-index: 2;
    }
    .pin-dots {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 21px;
      margin-top: 6px;
      margin-bottom: 2px;
    }
    .pin-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e0e0e0;
      margin: 0 2.5px;
      transition: background 0.1s;
    }
    .pin-dot.active { background: #ffd600; }
    .pin-dot.error { background: #e53935; }
    .pin-dot.success { background: #43a047; }
    .btn {
      display: block;
      width: 100%;
      padding: 0.6em 1em;
      margin-top: 12px;
      color: #fff;
      font-weight: bold;
      border-radius: 8px;
      font-size: 1.07em;
      text-align: center;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: background 0.13s, filter 0.13s;
      background: #2196f3;
      box-shadow: 0 1.5px 6px rgba(0,0,0,0.07);
    }
    .btn:active { filter: brightness(0.97);}
    .output-box {
      background: #f0f4c3;
      border: 1px solid #cddc39;
      border-radius: 7px;
      padding: 9px 8px 9px 12px;
      margin-top: 10px;
      word-wrap: break-word;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.98em;
      color: #444;
      position: relative;
      display: flex;
      align-items: center;
    }
    .pubkey-label { font-weight: bold; margin-right: 0.6em;}
    .public-key-value {
      background: #e6e6a1;
      padding: 6px 9px;
      border-radius: 5px;
      user-select: all;
      margin-right: 10px;
      display: inline-block;
      font-size: 0.96em;
      overflow-x: auto;
      max-width: 60vw;
    }
    .copy-btn {
      background: none; border: none; font-size: 1.18em;
      margin-left: 2px; margin-right: 4px; cursor:pointer;
      color: #2196f3;
      transition: color 0.15s;
    }
    .copy-btn.copied { color: #43a047;}
    .copy-status {
      font-size: 1em; color: #43a047; font-weight: bold;
      margin-left: 7px; opacity: 0; transition: opacity 0.3s;
      min-width: 58px; display: inline-block;
    }
    .copy-status.visible { opacity: 1;}
    .navbar {
      display: flex; justify-content: space-around;
      padding: 7px 0;
      background: #ede7f6;
      border-radius: 9px 9px 0 0;
      box-shadow: 0 1.5px 7px rgba(0,0,0,0.05);
      position: fixed;
      left: 0; right: 0; bottom: 0;
      max-width: 700px;
      margin: 0 auto; z-index: 99;
    }
    .navbar a {
      flex: 1; text-align: center;
      padding: 10px 4px;
      text-decoration: none;
      color: #6a1b9a;
      font-weight: bold;
      border-radius: 5px;
      transition: background 0.18s, color 0.18s;
      margin: 0 2.5px;
      font-size: 0.97em;
    }
    .navbar a:hover { background: #d1c4e9; color: #4a148c;}
    .navbar a.active {
      background: #9575cd;
      color: white;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.18);
    }
    @media (max-width: 600px) {
      body { margin: 0.18em; padding: 0.05em 0.01em 4em 0.01em;}
      h1 { font-size: 1em; margin-bottom: 0.6em; }
      .section-block { padding: 0.33em 0.1em;}
      .btn { font-size: 0.94em; padding: 0.39em 0.7em; }
      .block-title { font-size: 0.95em; }
      .navbar { padding: 4px 0; }
      .navbar a { font-size: 0.89em; padding: 7px 2px;}
      .output-box { font-size: 0.93em;}
      .public-key-value { max-width: 40vw;}
    }
  </style>
</head>
<body>
  <h1>DTC: Magic Chain System<br>
    <small>Decentralized Trust Community</small>
  </h1>

  <div class="section-block key-input-block">
    <div class="block-title">Generate Your Public Key</div>
    <div class="input-group">
      <label for="password">Password: <span class="input-symbol">üî§</span></label>
      <input type="password" id="password" autocomplete="new-password" />
      <span class="toggle-password" data-target="password">üëÅÔ∏è</span>
      <span class="status-icon" id="pw-status"></span>
    </div>
    <div class="input-group">
      <label for="confirmPassword">Confirm: <span class="input-symbol">üî§</span></label>
      <input type="password" id="confirmPassword" autocomplete="new-password" />
      <span class="toggle-password" data-target="confirmPassword">üëÅÔ∏è</span>
      <span class="status-icon" id="cpw-status"></span>
    </div>
    <div class="input-group">
      <label for="pin">PIN: <span class="input-symbol">üî¢</span></label>
      <input type="password" id="pin" maxlength="4" pattern="\d*" inputmode="numeric" />
      <span class="toggle-password" data-target="pin">üëÅÔ∏è</span>
      <span class="status-icon" id="pin-status"></span>
      <div class="pin-dots" id="pinDots">
        <div class="pin-dot"></div><div class="pin-dot"></div>
        <div class="pin-dot"></div><div class="pin-dot"></div>
      </div>
    </div>
    <div class="input-group">
      <label for="confirmPin">Confirm PIN: <span class="input-symbol">üî¢</span></label>
      <input type="password" id="confirmPin" maxlength="4" pattern="\d*" inputmode="numeric" />
      <span class="toggle-password" data-target="confirmPin">üëÅÔ∏è</span>
      <span class="status-icon" id="cpin-status"></span>
    </div>
    <button class="btn" id="generateKeyBtn">Generate Public Key</button>
  </div>

  <div class="section-block key-output-block" id="publicKeyOutputSection" style="display:none;">
    <div class="block-title">Your Public Key</div>
    <div class="output-box">
      <span class="pubkey-label">Public Key:</span>
      <span class="public-key-value" id="publicKey"></span>
      <button id="copyBtn" class="copy-btn" title="Copy">üìã</button>
      <span id="copyStatus" class="copy-status"></span>
    </div>
  </div>

  <div class="navbar">
    <a href="index.html">Back</a>
    <a href="index.html" class="active">Home</a>
    <a href="mint_qr.html">Next</a>
  </div>
  <script>
    // Status update for input fields (‚úì, ‚ùó, ‚Ä¶)
    function updateStatusIcon(field, valid) {
      let icon = document.getElementById(field + '-status');
      let input = document.getElementById(field);
      if (valid === 'valid') { icon.textContent = '‚úì'; icon.className = 'status-icon valid'; input.classList.add('valid'); input.classList.remove('invalid'); }
      else if (valid === 'pending') { icon.textContent = '‚Ä¶'; icon.className = 'status-icon pending'; input.classList.remove('valid','invalid'); }
      else if (valid === 'invalid') { icon.textContent = '‚ùó'; icon.className = 'status-icon invalid'; input.classList.add('invalid'); input.classList.remove('valid'); }
      else { icon.textContent = ''; icon.className = 'status-icon'; input.classList.remove('valid','invalid'); }
    }
    // Password, PIN visual logic
    function checkAllStatus() {
      const pw = passwordInput.value;
      const cpw = confirmPasswordInput.value;
      const pin = pinInput.value;
      const cpin = confirmPinInput.value;
      updateStatusIcon('password', pw ? 'pending' : '');
      updateStatusIcon('confirmPassword', cpw ? (cpw === pw && pw ? 'valid' : 'invalid') : '');
      updateStatusIcon('pin', pin.length === 4 && /^\d{4}$/.test(pin) ? 'valid' : (pin.length > 0 ? 'pending' : ''));
      updateStatusIcon('confirmPin', cpin ? (cpin === pin && pin.length === 4 ? 'valid' : 'invalid') : '');
      // pin dots visual
      updatePinDots(pin, cpin);
    }
    function updatePinDots(pin, cpin) {
      const dots = document.querySelectorAll('#pinDots .pin-dot');
      dots.forEach((dot, idx) => {
        dot.className = 'pin-dot' + (idx < pin.length ? ' active' : '');
        if(pin.length === 4 && cpin.length === 4 && pin !== cpin) dot.className += ' error';
        else if(pin.length === 4 && pin === cpin && pin.length) dot.className += ' success';
      });
    }
    // Copy public key
    function copyKey() {
      const pk = publicKeyDisplay.textContent;
      navigator.clipboard.writeText(pk);
      copyBtn.classList.add('copied');
      copyStatus.textContent = '‚úì Copied!';
      copyStatus.classList.add('visible');
      setTimeout(()=>{
        copyStatus.classList.remove('visible');
        copyBtn.classList.remove('copied');
      }, 1300);
    }
    // Inputs
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const pinInput = document.getElementById('pin');
    const confirmPinInput = document.getElementById('confirmPin');
    const generateKeyBtn = document.getElementById('generateKeyBtn');
    const publicKeyOutputSection = document.getElementById('publicKeyOutputSection');
    const publicKeyDisplay = document.getElementById('publicKey');
    const copyBtn = document.getElementById('copyBtn');
    const copyStatus = document.getElementById('copyStatus');

    // Toggle password show/hide
    document.querySelectorAll('.toggle-password').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const targetId = toggle.dataset.target;
        const targetInput = document.getElementById(targetId);
        if (targetInput.type === 'password') {
          targetInput.type = 'text'; toggle.textContent = 'üôà';
        } else { targetInput.type = 'password'; toggle.textContent = 'üëÅÔ∏è'; }
      });
    });

    // Real-time input feedback
    [passwordInput, confirmPasswordInput, pinInput, confirmPinInput].forEach(input => {
      input.addEventListener('input', checkAllStatus);
      input.addEventListener('blur', checkAllStatus);
    });

    // PIN dots
    function initPinDots() {
      updatePinDots(pinInput.value, confirmPinInput.value);
    }
    pinInput.addEventListener('input', initPinDots);
    confirmPinInput.addEventListener('input', initPinDots);

    // Generate Key
    generateKeyBtn.addEventListener('click', () => {
      const password = passwordInput.value.trim();
      const confirmPassword = confirmPasswordInput.value.trim();
      const pin = pinInput.value.trim();
      const confirmPin = confirmPinInput.value.trim();

      // Minimal: Only allow if all valid (no alert!)
      if (
        !password || !confirmPassword ||
        !pin || !confirmPin ||
        confirmPassword !== password ||
        pin.length !== 4 || !/^\d{4}$/.test(pin) ||
        confirmPin !== pin
      ) {
        // shake effect?
        generateKeyBtn.style.background = "#e53935";
        setTimeout(()=>{generateKeyBtn.style.background = "#2196f3";},600);
        checkAllStatus();
        return;
      }
      // Generate Public Key (demo)
      let str = password + pin + "DTC_Key_Salt_2025";
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash |= 0;
      }
      let mockPublicKey = Math.abs(hash).toString(16).padStart(16, '0');
      mockPublicKey += (Math.random() * 1e15).toString(16).padStart(12, '0');
      mockPublicKey += 'DTC-PUB';
      mockPublicKey = mockPublicKey.substring(0, 64);
      publicKeyDisplay.textContent = "0x" + mockPublicKey.toUpperCase();
      publicKeyOutputSection.style.display = 'block';
      copyStatus.textContent = '';
      checkAllStatus();
    });
    copyBtn.addEventListener('click', copyKey);

    // init
    checkAllStatus();
    initPinDots();
  </script>
</body>
</html>
