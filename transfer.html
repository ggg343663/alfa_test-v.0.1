<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transfer QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° QR SCAN LIBRARY -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      max-width: 700px;
      margin: 2em auto;
      padding: 1em;
      background: #f8fafc;
      color: #232a3e;
    }
    h2 { text-align: center; font-size: 1.4em; margin-bottom: 1.6em; letter-spacing: 0.01em; }
    .transfer-flex {
      display: flex; align-items: center; gap: 0.5em; justify-content: center;
      background: #fff; border-radius: 22px;
      box-shadow: 0 2px 14px rgba(44,62,80,0.07);
      padding: 1.5em 0.7em 1.3em 0.7em; margin-bottom: 2em;
    }
    .transfer-col { flex: 1 1 0; min-width: 0; display: flex; flex-direction: column; gap: 1.2em; padding: 1em 1.2em; border-radius: 14px; background: #f7fafd; }
    .sender { border: 2px solid #246bfd22; box-shadow: 0 1px 8px #246bfd13; margin-right: 0.7em; }
    .receiver { border: 2px solid #22d3ee33; box-shadow: 0 1px 8px #22d3ee11; margin-left: 0.7em; }
    .transfer-arrow { display: flex; align-items: center; justify-content: center; font-size: 2.3em; color: #6366f1; width: 60px; height: 60px; background: linear-gradient(135deg,#e0e7ff,#e0f7fa); border-radius: 50%; margin: 0 0.4em; box-shadow: 0 2px 10px #6366f120; border: 2px solid #e0e7ef; flex-shrink: 0;}
    .transfer-label { font-weight: 600; margin-bottom: 0.21em; font-size: 1em; letter-spacing: 0.01em; }
    input[type="text"], input[type="password"] { padding: 0.62em 0.85em; font-size: 1.08em; border-radius: 8px; border: 1px solid #d3d9ec; background: #f9fbff; transition: border-color 0.2s; }
    input:focus { border-color: #6366f1; outline: none; }
    .btn-row { margin-top: 1.3em; display: flex; flex-direction: column; gap: 0.7em; max-width: 360px; margin-left: auto; margin-right: auto; }
    button { font-family: inherit; font-weight: bold; font-size: 1.1em; padding: 0.76em 0; border-radius: 8px; border: none; background: linear-gradient(90deg, #6366f1, #22d3ee); color: #fff; box-shadow: 0 2px 8px rgba(44,62,80,0.08); cursor: pointer; letter-spacing: 0.02em; transition: background 0.16s, box-shadow 0.16s;}
    button:disabled { opacity: 0.52; cursor: not-allowed; background: #e4e9f7; color: #7c8ca7;}
    .back-btn { position: fixed; top: 18px; left: 16px; background: #e0e7ef; color: #363f5c; border: 1px solid #cdd2df; border-radius: 7px; font-size: 1em; padding: 0.36em 1.2em; cursor: pointer; z-index: 1000; box-shadow: 0 2px 8px rgba(99,102,241,0.03); transition: background 0.2s;}
    .back-btn:hover { background: #c7f7fa; color: #232a3e; }
    .qr-btns { display: flex; gap: 0.2em; margin-top: 0.3em;}
    #qr-reader { display: none; width: 260px; margin: 1em 0; }
    @media (max-width: 800px) { .transfer-flex { flex-direction: column; gap: 0.3em; padding: 0.8em 0.1em 0.6em;} .transfer-arrow { margin: 0.6em auto; } .sender, .receiver { margin: 0; } }
  </style>
</head>
<body>
  <button class="back-btn" onclick="history.back()">‚Üê Back</button>
  <h2>Transfer QR</h2>
  <div class="transfer-flex">
    <!-- Sender (left) -->
    <div class="transfer-col sender">
      <div class="transfer-label" style="color:#246bfd">Sender</div>
      <label class="transfer-label" for="qrhash">QR Hash (64 chars):</label>
      <div class="qr-btns">
        <input type="text" id="qrhash" maxlength="64" autocomplete="off" placeholder="Enter QR Hash" style="flex:1;"/>
        <button type="button" title="Scan QR" onclick="openQRScanner()">üì∑</button>
        <input type="file" accept="image/*" onchange="scanImageQR(this)" style="display:none;" id="imgQRInput">
        <button type="button" title="Import QR Image" onclick="document.getElementById('imgQRInput').click()">üñºÔ∏è</button>
      </div>
      <div id="qr-reader"></div>
      <label class="transfer-label" for="passphrase">Your Passphrase (6-12 letters & numbers):</label>
      <input type="password" id="passphrase" maxlength="12" minlength="6" autocomplete="off" placeholder="Enter your passphrase" />
      <label class="transfer-label" for="signcode">4-digit Sign Code:</label>
      <input type="password" id="signcode" maxlength="4" minlength="4" autocomplete="off" pattern="\d{4}" placeholder="Enter sign code (numbers only)" />
    </div>
    <!-- Arrow send -->
    <div class="transfer-arrow" aria-label="send">&#8594;</div>
    <!-- Recipient (right) -->
    <div class="transfer-col receiver">
      <div class="transfer-label" style="color:#22d3ee">Receiver</div>
      <label class="transfer-label" for="recipientpk">Recipient Public Key (40 chars):</label>
      <input type="text" id="recipientpk" maxlength="40" autocomplete="off" placeholder="Enter recipient's public key" />
    </div>
  </div>
  <div class="btn-row">
    <button id="previewBtn" onclick="preview()" type="button">Preview</button>
    <button id="confirmBtn" onclick="confirmTransfer()" type="button" disabled>Confirm Transfer</button>
  </div>
  <div id="previewBox" style="margin-top:1.5em;text-align:center;color:#232a3e;"></div>

  <script>
    let qrReader = null;
    function openQRScanner() {
      const qrDiv = document.getElementById('qr-reader');
      qrDiv.style.display = 'block';
      if (!qrReader) {
        qrReader = new Html5Qrcode("qr-reader");
      }
      qrReader.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 180 },
        qrCodeMessage => {
          document.getElementById('qrhash').value = qrCodeMessage;
          qrReader.stop();
          qrDiv.style.display = 'none';
        },
        errorMessage => {}
      ).catch(err => {
        alert("Cannot open camera: " + err);
        qrDiv.style.display = 'none';
      });
    }

    function scanImageQR(input) {
      if (input.files && input.files.length > 0) {
        const file = input.files[0];
        const qrDiv = document.getElementById('qr-reader');
        qrDiv.style.display = 'block';
        if (!qrReader) {
          qrReader = new Html5Qrcode("qr-reader");
        }
        qrReader.scanFile(file, true)
          .then(qrCodeMessage => {
            document.getElementById('qrhash').value = qrCodeMessage;
            qrReader.clear();
            qrDiv.style.display = 'none';
          })
          .catch(() => {
            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö QR ‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ");
            qrDiv.style.display = 'none';
          });
      }
    }

    function validateInputs() {
      const hash = document.getElementById('qrhash').value.trim();
      const pub = document.getElementById('recipientpk').value.trim();
      const pass = document.getElementById('passphrase').value.trim();
      const sign = document.getElementById('signcode').value.trim();
      let valid = true;
      if (hash.length !== 64) valid = false;
      if (pub.length !== 40) valid = false;
      if (pass.length < 6 || pass.length > 12 || !/[A-Za-z]/.test(pass) || !/\d/.test(pass)) valid = false;
      if (!/^\d{4}$/.test(sign)) valid = false;
      return valid;
    }

    function preview() {
      const isValid = validateInputs();
      const previewBtn = document.getElementById('previewBtn');
      const confirmBtn = document.getElementById('confirmBtn');
      const previewBox = document.getElementById('previewBox');
      if (!isValid) {
        previewBox.textContent = "‚ö†Ô∏è Please check and complete all input fields correctly.";
        confirmBtn.disabled = true;
        return;
      }
      const hash = document.getElementById('qrhash').value.trim();
      const pub = document.getElementById('recipientpk').value.trim();
      previewBox.innerHTML = `<b>Preview Transfer</b><br>
        <b>QR Hash:</b> <code>${hash}</code><br>
        <b>Recipient Public Key:</b> <code>${pub}</code>`;
      confirmBtn.disabled = false;
    }

    function confirmTransfer() {
      alert('‚úÖ Transfer submitted! (Add your backend logic here)');
      document.getElementById('previewBox').textContent = "";
      document.getElementById('confirmBtn').disabled = true;
    }
  </script>
</body>
</html>
