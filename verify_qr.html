<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verify QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 500px; margin: 2em auto; background: #f9fafd;}
    .container { background: #fff; padding: 2em 1.2em; border-radius: 13px; box-shadow: 0 2px 12px #e1e5f5; }
    h2 { text-align: center; color: #26733e; margin-bottom: 1.2em;}
    label { font-weight: bold; margin-bottom: 0.3em; }
    input { width: 100%; padding: 0.53em; font-size: 1em; border-radius: 4px; border: 1.3px solid #d0d7e5; margin-top: 0.3em;}
    button { margin-top: 1.2em; padding: 0.6em 1.1em; font-size: 1em; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer;}
    button:hover { background: #176d38;}
    .result-box { margin-top: 1.5em; padding: 1.1em; border-radius: 9px; font-size: 1.09em; }
    .ok { background: #eafaf0; color: #26733e; border: 1.7px solid #64bc6d;}
    .registered { background: #e3eafe; color: #234bb6; border: 1.7px solid #6c85e3;}
    .fail { background: #ffe9e9; color: #b61b1b; border: 1.7px solid #ef8888;}
    .info { margin-top: 0.8em; }
    .back-btn { margin-top: 1.3em; background: #dbeafe; color: #324275; border-radius: 6px; border: 1px solid #b3c4df; }
    .back-btn:hover { background: #bae6fd;}
    code { background: #f0f2f9; padding: 0.14em 0.5em; border-radius: 5px;}
  </style>
</head>
<body>
  <div class="container">
    <h2>Verify QR</h2>
    <label for="qrhash">QR Hash (64 chars):</label>
    <input id="qrhash" maxlength="64" placeholder="Enter QR hash" />
    <button onclick="verifyQR()">Check QR</button>
    <div id="result"></div>
    <button class="back-btn" onclick="window.history.back()">← Back</button>
  </div>
<script>
const WHITELIST = [
  "A9F11...1CDE", "0A4D2...F1B2", "B8A233...3BAF" // 64 chars (demo)
];
const MOCK_LOGS = [
  {
    qr_hash: "A9F11...1CDE",
    status: "registered",
    owner: "0x0fA...123",
    timestamp: "2024-06-02T09:13:44Z",
    chain: [
      { action: "registered", by: "0x0fA...123", time: "2024-06-02T09:13:44Z" }
    ]
  }
  // add more logs if needed
];

function verifyQR() {
  const qrhash = document.getElementById("qrhash").value.trim();
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  if (qrhash.length !== 64) {
    resultDiv.innerHTML = `<div class="result-box fail">Please enter a valid 64-character QR hash.</div>`;
    return;
  }
  // Check whitelist
  const isInWhitelist = WHITELIST.some(qr => qr.replace(/\./g,"") === qrhash);
  if (!isInWhitelist) {
    resultDiv.innerHTML = `<div class="result-box fail">
      This QR code is <b>not eligible</b> for registration.
    </div>`;
    return;
  }
  // Check log (already registered?)
  const log = MOCK_LOGS.find(l => l.qr_hash.replace(/\./g,"") === qrhash);
  if (!log) {
    resultDiv.innerHTML = `<div class="result-box ok">
      <b>Not yet registered.</b><br>
      <span class="info">You can register this QR code.</span>
    </div>`;
    return;
  }
  // If registered, show details
  resultDiv.innerHTML = `
    <div class="result-box registered">
      <b>Registered</b><br>
      <b>Owner:</b> <code>${log.owner}</code><br>
      <b>Status:</b> ${log.status}<br>
      <b>Timestamp:</b> ${log.timestamp}<br>
      <b>History chain:</b>
      <div class="info">
        ${log.chain.map(c =>
          `${c.action.toUpperCase()}<br>
           <b>By:</b> <code>${c.by}</code>${c.to ? ` → <b>To:</b> <code>${c.to}</code>` : ''}<br>
           <b>At:</b> ${c.time}`
        ).join('<hr style="border:none;border-top:1px solid #e2e7fa;">')}
      </div>
    </div>
  `;
}
</script>
</body>
</html>
