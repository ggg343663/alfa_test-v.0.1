<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generate Address from Passphrase</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
      background-color: #f9f9f9;
      border-radius: 8px;
      position: relative;
    }
    .back-btn {
      position: fixed;
      top: 18px;
      left: 16px;
      background: #eee;
      color: #222;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
      padding: 0.4em 1.1em;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      transition: background 0.2s;
    }
    .back-btn:hover {
      background: #d6f5d6;
      color: #1a7f3c;
    }
    @media (max-width: 600px) {
      .back-btn { top: 10px; left: 8px; font-size: 0.97em; padding: 0.34em 0.9em;}
    }
    input, textarea {
      width: 100%;
      padding: 0.5em;
      font-size: 1em;
      margin-top: 0.3em;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    input.invalid { border-color: red; }
    input.valid { border-color: green; }
    button:not(.back-btn) {
      margin-top: 1em;
      padding: 0.7em 1.2em;
      font-size: 1em;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:not(.back-btn):hover { background-color: #45a049; }
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 36px;
      cursor: pointer;
      font-size: 0.9em;
      color: #555;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1em;
      position: relative;
    }
    .status {
      font-size: 0.9em;
      margin-top: 0.3em;
      color: green;
      display: none;
    }
    .error {
      color: red;
      font-size: 0.95em;
      margin-top: 0.2em;
    }
  </style>
</head>
<body>
  <button class="back-btn" onclick="history.back()">‚Üê Back</button>
  <h2 style="margin-top:1.5em;">üîê Generate Address (Web3-style) from Passphrase</h2>

  <label>
    Passphrase (6-12 chars, must include letters & numbers):
    <input type="password" id="privateKey1" maxlength="12" minlength="6" autocomplete="off"/>
    <span class="toggle-password" data-target="privateKey1">Show</span>
    <div id="pw1Err" class="error"></div>
  </label>

  <label>
    Confirm Passphrase:
    <input type="password" id="privateKey2" maxlength="12" minlength="6" autocomplete="off"/>
    <span class="toggle-password" data-target="privateKey2">Show</span>
    <div id="pw2Err" class="error"></div>
  </label>

  <label>
    Sign Code (4 digits):
    <input type="password" id="signCode1" maxlength="4" minlength="4" pattern="\d{4}" autocomplete="off"/>
    <div id="sign1Err" class="error"></div>
  </label>

  <label>
    Confirm Sign Code:
    <input type="password" id="signCode2" maxlength="4" minlength="4" pattern="\d{4}" autocomplete="off"/>
    <div id="sign2Err" class="error"></div>
  </label>

  <button onclick="generateAddress()">üöÄ Generate Address</button>

  <h3>üîë Private Key (SHA-256):</h3>
  <textarea id="fullHash" rows="2" readonly></textarea>

  <h3>üìÆ Address (last 40 chars):</h3>
  <textarea id="addressOutput" rows="2" readonly></textarea>

  <button onclick="copyAddress()">üìã Copy Address</button>
  <div id="copyStatus" class="status">‚úÖ Address copied!</div>

  <script>
    // Toggle show/hide password
    document.querySelectorAll(".toggle-password").forEach(span => {
      span.addEventListener("click", () => {
        const id = span.getAttribute("data-target");
        const input = document.getElementById(id);
        if (input.type === "password") {
          input.type = "text";
          span.textContent = "Hide";
        } else {
          input.type = "password";
          span.textContent = "Show";
        }
      });
    });

    function validatePassword(pw) {
      return (
        pw.length >= 6 &&
        pw.length <= 12 &&
        /[A-Za-z]/.test(pw) &&
        /\d/.test(pw)
      );
    }

    function validateSign(sign) {
      return /^\d{4}$/.test(sign);
    }

    async function sha256Hex(str) {
      const buffer = new TextEncoder().encode(str);
      const hash = await crypto.subtle.digest("SHA-256", buffer);
      return [...new Uint8Array(hash)].map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function generateAddress() {
      // Inputs
      const pw1 = document.getElementById("privateKey1").value.trim();
      const pw2 = document.getElementById("privateKey2").value.trim();
      const sign1 = document.getElementById("signCode1").value.trim();
      const sign2 = document.getElementById("signCode2").value.trim();
      const fullHashEl = document.getElementById("fullHash");
      const addressEl = document.getElementById("addressOutput");
      const status = document.getElementById("copyStatus");
      // Errors
      const pw1Err = document.getElementById("pw1Err");
      const pw2Err = document.getElementById("pw2Err");
      const sign1Err = document.getElementById("sign1Err");
      const sign2Err = document.getElementById("sign2Err");

      let valid = true;
      pw1Err.textContent = "";
      pw2Err.textContent = "";
      sign1Err.textContent = "";
      sign2Err.textContent = "";

      if (!validatePassword(pw1)) {
        pw1Err.textContent = "Must be 6-12 chars, include letters & numbers.";
        valid = false;
      }
      if (pw1 !== pw2) {
        pw2Err.textContent = "Passphrases do not match.";
        valid = false;
      }
      if (!validateSign(sign1)) {
        sign1Err.textContent = "Sign code must be 4 digits.";
        valid = false;
      }
      if (sign1 !== sign2) {
        sign2Err.textContent = "Sign codes do not match.";
        valid = false;
      }
      if (!valid) return;

      // Use password + sign code together to generate address
      const hash = await sha256Hex(pw1 + sign1);
      const address = "0x" + hash.slice(-40);

      fullHashEl.value = hash;
      addressEl.value = address;
      status.style.display = "none";
      alert("‚úÖ Address generated. Please back up your private info securely.");
    }

    function copyAddress() {
      const addressEl = document.getElementById("addressOutput");
      if (!addressEl.value) {
        alert("‚ö† Please generate Address first.");
        return;
      }
      addressEl.select();
      addressEl.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(addressEl.value).then(() => {
        const status = document.getElementById("copyStatus");
        status.style.display = "block";
        setTimeout(() => status.style.display = "none", 2000);
      });
    }
  </script>
</body>
</html>
