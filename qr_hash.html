<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Generate QR Hash</title>
</head>
<body>
  <h2>2. สร้าง QR Hash จาก Public Key</h2>
  <p>Public Key ที่ใช้: <span id="pub-key-display">กำลังโหลด...</span></p>
  <button id="gen-qr-btn">Generate QR Hash</button>
  <p>QR Hash: <span id="qr-hash-output">ยังไม่ได้สร้าง</span></p>

  <script>
    // ฟังก์ชัน sha256() แบบเดียวกับหน้า generate_key.html
    function sha256(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash |= 0;
      }
      return hash.toString(16).padStart(64, '0');
    }

    // โหลด Public Key จาก localStorage มาแสดง
    const pubKey = localStorage.getItem('dtc_publicKey');
    if (pubKey) {
      document.getElementById('pub-key-display').textContent = pubKey;
    } else {
      document.getElementById('pub-key-display').textContent = 'ไม่พบ Public Key กรุณาสร้างที่หน้า 1';
    }

    document.getElementById('gen-qr-btn').addEventListener('click', () => {
      if (!pubKey) {
        alert('ไม่พบ Public Key กรุณากลับไปหน้า 1 เพื่อสร้างก่อน');
        return;
      }
      // สร้าง QR Hash จาก Public Key + timestamp ปัจจุบัน (ตัวอย่าง)
      const timestamp = Date.now().toString();
      const qrHash = sha256(pubKey + timestamp);

      // แสดงผลบนหน้า
      document.getElementById('qr-hash-output').textContent = qrHash;
      // เก็บ QR Hash ใน localStorage (key: "dtc_qrHash")
      localStorage.setItem('dtc_qrHash', qrHash);

      alert('QR Hash ถูกสร้างแล้ว! คุณสามารถไปหน้าลงทะเบียนต่อได้');
    });
  </script>
</body>
</html>
