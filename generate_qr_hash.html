<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Generate QR Hash (Mint) - DTC: Magic Chain System</title>
    <style>
        :root {
            --color-primary-green: #219150;
            --color-info-blue: #2196f3;
            --color-audit-yellow: #ffd600;
            --color-doc-grey: #90a4ae;
            --color-body-bg: #f5f7fa;
            --color-menu-bg: #fff;
            --color-text-main: #333;
            --color-label-grey: #90a4ae;
            --color-sensitive-input-bg: #fffde7;
            --color-success-border: #43a047;
            --color-error-border: #e53935;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 700px;
            margin: 2em auto;
            padding: 1em;
            background: var(--color-body-bg);
            color: var(--color-text-main);
        }
        h1 {
            text-align: center;
            color: var(--color-primary-green);
            margin-bottom: 1.2em;
            letter-spacing: 0.02em;
        }
        h1 small {
            display: block;
            font-size: 0.5em;
            color: #555;
            margin-top: 0.5em;
        }
        .intro-section {
            background-color: #e0f2f7;
            border-left: 5px solid #00acc1;
            padding: 1.2em;
            margin-bottom: 2em;
            border-radius: 8px;
            box-shadow: 0 2px 7px rgba(0,0,0,0.05);
            color: #444;
            text-align: center;
            font-size: 0.96em;
        }
        .section-block { margin: 1.1em 0; padding: 1.5em; border-radius: 12px; box-shadow: 0 2px 9px #edf1f6;}
        .block-title { font-size: 1.08em; font-weight: bold; margin-bottom: 0.9em; color: #555; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 0.5em;}
        .qr-input-block { background: var(--color-sensitive-input-bg); border-left: 6px solid var(--color-audit-yellow);}
        .qr-issuer-block { background: var(--color-body-bg); border-left: 6px solid var(--color-info-blue);}
        .qr-meta-block { background: var(--color-body-bg); border-left: 6px solid var(--color-doc-grey);}
        .btn-main { width:100%; margin:18px 0 0 0; padding:1em 1.2em; color:#fff; background:linear-gradient(90deg,var(--color-info-blue) 70%,var(--color-primary-green) 100%); font-weight:bold; font-size:1.16em; border-radius:8px; border:none; cursor:pointer; box-shadow:0 2px 9px rgba(33,150,243,0.27); transition: background 0.2s;}
        .btn-main:active { background:#176d38; }
        .btn-main:hover:not([disabled]) { filter: brightness(0.95); }
        .btn-main[disabled] { opacity:.56; cursor:not-allowed; }
        .btn-confirm { width:100%; margin-top:15px; background:linear-gradient(90deg,var(--color-primary-green) 75%,#44cc77 100%); color:#fff; font-weight:bold; font-size:1.12em; border:none; border-radius:8px; padding:1em 0; cursor:pointer; transition: background .13s, filter .13s;}
        .btn-confirm:hover { filter: brightness(0.96);}
        .btn-confirm:active { background:#176d38; }
        .btn-cancel { width:100%; background:var(--color-body-bg); color:var(--color-info-blue); border:1.5px solid var(--color-info-blue); border-radius:8px; font-weight:bold; font-size:1em; padding:0.9em 0; margin-top:0.7em; cursor:pointer; transition: background .13s, color .13s;}
        .btn-cancel:hover { background:#e0f7fa; color:#176d38; }
        .input-group { margin-bottom: 15px; position:relative; }
        .input-group label { font-weight: bold; color: #666; font-size: 0.95em; margin-bottom: 5px; display:block;}
        .input-group input[type="password"], .input-group input[type="text"], .input-group textarea, .input-group select {
            width: calc(100% - 24px); padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em; background-color: #ffffff; box-sizing: border-box;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .input-group input[type="password"]:focus, .input-group input[type="text"]:focus, .input-group textarea:focus, .input-group select:focus {
            border-color: var(--color-info-blue); background-color: #f0f7ff;
        }
        .input-group input#pin, .input-group input#secretData { background-color: var(--color-sensitive-input-bg);}
        .label-hint { display:block; font-size:0.81em; color:var(--color-label-grey); margin-top:5px;}
        .toggle-password { position:absolute; right:12px; top:62%; transform:translateY(-50%); cursor:pointer; color:var(--color-label-grey); font-size:0.92em; }
        .footer-note { text-align:center; margin-top:2.4em; color:#b0bec5; font-size:0.97em; }
        /* ...ส่วนอื่นคงเดิม... */
        /* ให้คง style เดิมตามไฟล์ก่อนหน้าได้เลย */
        @media (max-width:600px){ body {margin:0.4em; padding:0.07em;} .section-block, .qr-output-block { padding:0.8em 0.2em;} }
    </style>
</head>
<body>
    <h1>DTC: Magic Chain System <br><small>Decentralized Trust Community</small></h1>
    <div class="intro-section">
        <p>หน้านี้ใช้สำหรับ <b>สร้าง (Mint) QR Hash</b> ใหม่ โดย Public Key ของคุณจะเป็นตัวตนผู้ออก QR</p>
        <p>แต่ละ Batch ของ QR จะถูกบันทึกเป็น Record ใหม่บน Decentralized Traceability Chain.</p>
    </div>
    <div class="section-block qr-issuer-block">
        <div class="block-title">1. ระบุผู้ออก QR (Master/Agent)</div>
        <div class="input-group">
            <label for="masterAgentQrHash">Master/Agent QR Hash:</label>
            <input type="text" id="masterAgentQrHash" placeholder="กรอก QR Hash ของ Master หรือ Agent Node" />
            <span class="label-hint">QR Hash ที่ใช้ระบุตัวตน Master หรือ Agent Node ที่ออก QR นี้</span>
        </div>
        <div class="key-address-display" id="associatedKeyAddressDisplay" style="display:none;">
            <label>Public Key (ผู้ออก):</label>
            <div class="key-address-value" id="associatedPublicKey"></div>
            <label style="margin-top: 0.5em;">Public Address (สำหรับ Lookup):</label>
            <div class="key-address-value" id="associatedPublicAddress"></div>
            <span class="label-hint">Public Key และ Public Address ที่เกี่ยวข้องกับ Master/Agent QR Hash ที่กรอก</span>
        </div>
    </div>
    <div class="section-block qr-meta-block">
        <div class="block-title">2. ข้อมูล Batch</div>
        <div class="input-group">
            <label for="batchName">ชื่อ Batch:</label>
            <input type="text" id="batchName" placeholder="เช่น 'PRODUCT_A' หรือ 'product:b'" />
            <span class="label-hint" id="batchNameHint">ชื่อสำหรับระบุ Batch (Master: ตัวพิมพ์ใหญ่ ≤8, Agent: ตัวพิมพ์เล็ก ≤16, ใช้ ':' แทนเว้นวรรค)</span>
        </div>
        <div class="input-group">
            <label for="quantity">จำนวน QR ที่จะสร้าง:</label>
            <select id="quantity" class="w-full" disabled>
                <option value="">เลือกจำนวน</option>
                <option value="100">100</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
                <option value="3000">3000</option>
                <option value="5000">5000</option>
            </select>
            <span class="label-hint" id="quantityHint">จำนวน QR Code ที่เหมือนกันที่จะสร้าง (จำกัดตามสิทธิ์ของผู้ออก)</span>
        </div>
    </div>
    <div class="section-block qr-input-block">
        <div class="block-title">3. ยืนยันและข้อมูลลับ</div>
        <div class="input-group">
            <label for="pin">PIN (5 หลัก):</label>
            <input type="password" id="pin" maxlength="5" pattern="\d{5}" inputmode="numeric" placeholder="กรอก PIN 5 หลักของคุณ" />
            <span class="toggle-password" data-target="pin">แสดง</span>
            <span class="label-hint">PIN นี้จะใช้สำหรับยืนยันสิทธิ์</span>
        </div>
        <div class="input-group">
            <label for="secretData">Secret:</label>
            <input type="text" id="secretData" maxlength="5" placeholder="กรอก 5 ตัวอักษรพิมพ์เล็ก a-z (เช่น 'abcde')" />
            <span class="label-hint">ข้อมูลลับเฉพาะของ QR นี้ ต้องเป็น 5 ตัวอักษรพิมพ์เล็ก a-z เท่านั้น</span>
        </div>
    </div>
    <button class="btn-main" id="previewBtn" disabled>ดูตัวอย่าง QR Batch</button>
    <!-- ...ส่วน Preview Modal, Output Section, Script เหมือนกับเวอร์ชันก่อน... -->
    <div class="navbar">
        <a href="generate_key.html" class="nav-btn">ย้อนกลับ (Generate Key)</a>
        <a href="index.html" class="nav-btn">หน้าหลัก</a>
        <a href="audit_chain.html" class="nav-btn">ถัดไป (Audit Chain)</a>
    </div>
    <p class="footer-note">พัฒนาและติดตั้งบน GitHub Pages • ระบบ Mobile-Friendly 100%</p>
    <script>
    // ...ส่วน Script เหมือนเดิม ตรวจสอบ validPin ให้เป็น /^\d{5}$/ ทุกจุด ...
    </script>
</body>
</html>
