<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Genesis ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ Master Request</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: 2em auto; }
    label, input, button { display: block; margin: 0.7em 0; width: 100%; }
    pre { background: #f8f8f8; padding: 1em; white-space: pre-wrap; border: 1px solid #ccc; border-radius: 5px; }
    .hidden { display: none; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h2>Genesis ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ Master</h2>
  <form id="approveForm">
    <label>Hash ‡∏Ñ‡∏≥‡∏Ç‡∏≠ Master: <input type="text" id="requestHash" maxlength="64" required /></label>
    <label>Public Key (Genesis): <input type="text" id="adminPubkey" required /></label>
    <label>Private Key 1: <input type="password" id="privKey1" required /></label>
    <label>Private Key 2: <input type="password" id="privKey2" required /></label>
    <button type="button" onclick="previewApprove()">üìã ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
  </form>

  <div id="previewBox" class="hidden">
    <h4>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏ã‡πá‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</h4>
    <pre id="previewContent"></pre>
    <button onclick="confirmApprove()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
    <button onclick="document.getElementById('previewBox').classList.add('hidden')">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>

  <pre id="approveResult"></pre>

  <script>
    let finalLog = null;

    function previewApprove() {
      const hash = document.getElementById('requestHash').value.trim();
      const pubkey = document.getElementById('adminPubkey').value.trim();
      const priv1 = document.getElementById('privKey1').value.trim();
      const priv2 = document.getElementById('privKey2').value.trim();

      if (!hash || !pubkey || !priv1 || !priv2) {
        alert("‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á");
        return;
      }

      const timestamp = new Date().toISOString();
      const sig1 = sha256(priv1 + hash);
      const sig2 = sha256(priv2 + sig1);

      finalLog = {
        type: "master_approve",
        request_hash: hash,
        approved_by: pubkey,
        sig1: sig1,
        sig2: sig2,
        timestamp: timestamp,
        status: "approved"
      };

      document.getElementById('previewContent').innerText = JSON.stringify(finalLog, null, 2);
      document.getElementById('previewBox').classList.remove('hidden');
    }

    function confirmApprove() {
      if (!finalLog) return;

      document.getElementById('approveResult').innerText =
        `üìå ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÉ‡∏™‡πà logs.json\n\n${JSON.stringify(finalLog, null, 2)}`;

      document.getElementById('previewBox').classList.add('hidden');
    }
  </script>
</body>
</html>
